<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>ä¸­æ–‡ Chinese</title>
  
  <!-- PWA / iOS App Features -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="ä¸­æ–‡ Quiz">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#0a0a0f">
  <meta name="description" content="Chinese vocabulary quiz app">
  
  <!-- App Icon (inline SVG as data URL) -->
<link rel="apple-touch-icon" href="icon-180.png">
<link rel="icon" href="icon-180.png">
  
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0a0a0f;--card:#1a1a2e;--card2:#16213e;--accent:#e94560;--glow:rgba(233,69,96,0.4);--light:#eaeaea;--muted:#8892b0;--ok:#64ffda;--warn:#ffd93d;--purple:#bd93f9;--wrong:#ff6b6b}
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}
    html{height:100%;overflow:hidden}
    body{font-family:'Space Mono',monospace;background:var(--bg);min-height:100vh;min-height:-webkit-fill-available;color:var(--light);overflow-x:hidden;padding-top:env(safe-area-inset-top);padding-bottom:env(safe-area-inset-bottom);padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right)}
    
    /* Gradient overlay for atmosphere */
    body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse at 20% 80%,rgba(233,69,96,.1)0,transparent 50%),radial-gradient(ellipse at 80% 20%,rgba(100,255,218,.08)0,transparent 50%),radial-gradient(ellipse at 50% 50%,rgba(189,147,249,.05)0,transparent 60%);pointer-events:none;z-index:-1}
    
    /* Splash screen */
    .splash{position:fixed;inset:0;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:2000;transition:opacity .5s,visibility .5s}
    .splash.hidden{opacity:0;visibility:hidden}
    .splash-logo{font-size:5rem;color:var(--accent);margin-bottom:1rem;animation:splashPulse 1.5s ease-in-out infinite}
    .splash-text{font-size:1rem;color:var(--muted);letter-spacing:.3em;text-transform:uppercase}
    @keyframes splashPulse{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.05);opacity:.8}}
    
    .container{max-width:900px;margin:0 auto;padding:1.5rem;padding-top:calc(1.5rem + env(safe-area-inset-top));min-height:100vh;min-height:-webkit-fill-available;display:flex;flex-direction:column;position:relative;z-index:1;overflow-y:auto;-webkit-overflow-scrolling:touch}
    
    /* Main Menu */
    .main-menu{flex:1;display:flex;flex-direction:column;padding-bottom:2rem}
    .menu-header{text-align:center;margin-bottom:2rem;position:relative}
    .menu-header h1{font-size:2.2rem;letter-spacing:.2em;text-transform:uppercase;color:var(--accent);text-shadow:0 0 40px var(--glow),0 0 80px rgba(233,69,96,.2);margin-bottom:.5rem}
    .menu-header p{color:var(--muted);font-size:.8rem}
    
    .settings-btn{position:absolute;top:0;right:0;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.1);color:var(--muted);width:40px;height:40px;border-radius:50%;cursor:pointer;transition:all .15s;display:flex;align-items:center;justify-content:center;font-size:1.2rem}
    @media(hover:hover) and (pointer:fine){.settings-btn:hover{border-color:var(--accent);color:var(--accent);transform:rotate(45deg);box-shadow:0 0 20px var(--glow)}}
    .settings-btn:active{border-color:var(--accent);color:var(--accent);transform:scale(.95);box-shadow:0 0 15px var(--glow)}
    
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.8);z-index:1000;display:none;align-items:center;justify-content:center;padding:1rem;backdrop-filter:blur(4px)}
    .modal-overlay.show{display:flex}
    .modal{background:linear-gradient(165deg,rgba(26,26,46,.98),rgba(10,10,15,.99));border:1px solid rgba(255,255,255,.1);border-radius:16px;padding:2rem;max-width:400px;width:100%;box-shadow:0 25px 60px rgba(0,0,0,.6),0 0 40px rgba(233,69,96,.1);animation:modalEntrance .3s ease-out}
    @keyframes modalEntrance{from{opacity:0;transform:scale(.95) translateY(-20px)}to{opacity:1;transform:scale(1) translateY(0)}}
    .modal h2{font-size:1rem;color:var(--accent);text-transform:uppercase;letter-spacing:.15em;margin-bottom:1.5rem;text-align:center}
    .modal-section{margin-bottom:1.5rem}
    .modal-section h3{font-size:.7rem;color:var(--muted);text-transform:uppercase;letter-spacing:.1em;margin-bottom:.75rem}
    .reset-btn{width:100%;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.1);color:var(--light);padding:.75rem 1rem;font-family:inherit;font-size:.75rem;cursor:pointer;border-radius:8px;transition:all .15s;text-align:left;margin-bottom:.5rem;display:flex;justify-content:space-between;align-items:center}
    @media(hover:hover) and (pointer:fine){.reset-btn:hover{border-color:var(--warn);background:rgba(255,217,61,.05);color:var(--warn)}}
    .reset-btn:active{border-color:var(--warn);background:rgba(255,217,61,.08);color:var(--warn);transform:scale(.98)}
    .reset-btn .level-name{font-weight:700}
    .reset-btn .level-info{font-size:.65rem;color:var(--muted)}
    @media(hover:hover) and (pointer:fine){.reset-btn:hover .level-info{color:var(--warn)}}
    .reset-btn:active .level-info{color:var(--warn)}
    .reset-all-btn{border-color:rgba(255,107,107,.3);color:var(--wrong)}
    @media(hover:hover) and (pointer:fine){.reset-all-btn:hover{border-color:var(--wrong);background:rgba(255,107,107,.1)}}
    .reset-all-btn:active{border-color:var(--wrong);background:rgba(255,107,107,.12);transform:scale(.98)}
    .modal-close{width:100%;background:transparent;border:1px solid rgba(255,255,255,.1);color:var(--muted);padding:.75rem;font-family:inherit;font-size:.7rem;text-transform:uppercase;letter-spacing:.1em;cursor:pointer;border-radius:8px;transition:all .15s;margin-top:.5rem}
    @media(hover:hover) and (pointer:fine){.modal-close:hover{border-color:var(--light);color:var(--light)}}
    .modal-close:active{border-color:var(--light);color:var(--light);transform:scale(.98)}
    
    .global-stats{display:flex;justify-content:center;gap:2rem;margin-top:1.5rem;flex-wrap:wrap}
    .global-stat{text-align:center;padding:1rem 1.5rem;background:linear-gradient(165deg,rgba(26,26,46,.6),rgba(15,15,26,.8));border-radius:12px;box-shadow:inset 0 1px 0 rgba(255,255,255,.08),inset 0 -8px 20px rgba(0,0,0,.3),0 8px 32px rgba(0,0,0,.4),0 0 20px rgba(100,255,218,.05);border:1px solid rgba(100,255,218,.1)}
    .global-stat .value{font-size:1.5rem;color:var(--ok);font-weight:700;text-shadow:0 0 20px rgba(100,255,218,.4)}
    .global-stat .label{font-size:.65rem;color:var(--muted);text-transform:uppercase;letter-spacing:.1em}
    
    .menu-sections{display:flex;flex-direction:column;gap:1.5rem}
    .menu-section{background:linear-gradient(165deg,rgba(26,26,46,.6),rgba(15,15,26,.8));border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:1.5rem;box-shadow:inset 0 1px 0 rgba(255,255,255,.05),inset 0 -10px 30px rgba(0,0,0,.2),0 10px 40px rgba(0,0,0,.3)}
    .menu-section h2{font-size:.7rem;letter-spacing:.2em;text-transform:uppercase;color:var(--muted);margin-bottom:1rem;display:flex;align-items:center;gap:.5rem}
    .review-section h2{color:var(--warn)}
    
    .level-header{display:flex;justify-content:space-between;align-items:center;cursor:pointer;padding:.5rem 0}
    @media(hover:hover) and (pointer:fine){.level-header:hover .level-title{color:var(--accent);text-shadow:0 0 20px var(--glow)}}
    .level-header:active .level-title{color:var(--accent);text-shadow:0 0 20px var(--glow)}
    .level-title{font-size:1rem;font-weight:700;transition:all .2s}
    .level-meta{display:flex;align-items:center;gap:1rem}
    .level-progress{font-size:.65rem;color:var(--muted)}
    .level-accuracy{font-size:.65rem;color:var(--ok)}
    .expand-icon{color:var(--muted);transition:transform .3s}
    .level-header.expanded .expand-icon{transform:rotate(180deg)}
    
    .play-all-btn{background:linear-gradient(145deg,var(--accent),#c13a52);border:none;color:#fff;padding:.5rem 1rem;font-family:inherit;font-size:.65rem;letter-spacing:.1em;text-transform:uppercase;cursor:pointer;border-radius:6px;margin-left:1rem;transition:all .15s;box-shadow:inset 0 1px 0 rgba(255,255,255,.2),0 4px 15px rgba(233,69,96,.3)}
    @media(hover:hover) and (pointer:fine){.play-all-btn:hover{box-shadow:inset 0 1px 0 rgba(255,255,255,.2),0 6px 25px rgba(233,69,96,.5),0 0 30px var(--glow);transform:translateY(-2px)}}
    .play-all-btn:active{box-shadow:inset 0 1px 0 rgba(255,255,255,.2),0 2px 10px rgba(233,69,96,.4);transform:scale(.97)}
    
    .category-grid{display:none;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:.75rem}
    .category-grid.expanded{display:grid;margin-top:1rem;padding-top:.5rem;border-top:1px solid rgba(255,255,255,.05)}
    
    .category-card{background:linear-gradient(165deg,rgba(26,26,46,.9),rgba(10,10,15,.95));border:1px solid rgba(255,255,255,.06);border-radius:10px;padding:.9rem;cursor:pointer;transition:all .15s;position:relative;box-shadow:inset 0 1px 0 rgba(255,255,255,.06),inset 0 -4px 12px rgba(0,0,0,.3),0 4px 12px rgba(0,0,0,.3)}
    @media(hover:hover) and (pointer:fine){.category-card:hover{border-color:var(--accent);transform:translateY(-2px);box-shadow:inset 0 1px 0 rgba(255,255,255,.1),inset 0 -4px 12px rgba(0,0,0,.3),0 8px 24px rgba(0,0,0,.4),0 0 20px var(--glow)}}
    .category-card:active{border-color:var(--accent);transform:scale(.98);box-shadow:inset 0 1px 0 rgba(255,255,255,.1),inset 0 -4px 12px rgba(0,0,0,.3),0 4px 16px rgba(0,0,0,.4),0 0 15px var(--glow)}
    .category-card.review-card{border-color:rgba(255,217,61,.15)}
    @media(hover:hover) and (pointer:fine){.category-card.review-card:hover{border-color:var(--warn);box-shadow:inset 0 1px 0 rgba(255,255,255,.1),inset 0 -4px 12px rgba(0,0,0,.3),0 8px 24px rgba(0,0,0,.4),0 0 20px rgba(255,217,61,.3)}}
    .category-card.review-card:active{border-color:var(--warn);box-shadow:inset 0 1px 0 rgba(255,255,255,.1),inset 0 -4px 12px rgba(0,0,0,.3),0 4px 16px rgba(0,0,0,.4),0 0 15px rgba(255,217,61,.3)}
    .category-card.empty{opacity:.5;cursor:default}
    .category-card.empty:hover,.category-card.empty:active{transform:none;border-color:rgba(255,255,255,.06);box-shadow:inset 0 1px 0 rgba(255,255,255,.06),inset 0 -4px 12px rgba(0,0,0,.3),0 4px 12px rgba(0,0,0,.3)}
    .category-card.mastered{border-color:rgba(100,255,218,.15)}
    .category-card.mastered .category-name{color:var(--ok);text-shadow:0 0 12px rgba(100,255,218,.3)}
    .category-name{font-size:.8rem;font-weight:700;margin-bottom:.35rem}
    .category-count{font-size:.6rem;color:var(--muted)}
    .category-progress{width:100%;height:2px;background:rgba(255,255,255,.06);border-radius:2px;margin-top:.5rem;overflow:hidden}
    .category-progress-fill{height:100%;background:linear-gradient(90deg,var(--ok),var(--purple));box-shadow:0 0 8px rgba(100,255,218,.4);transition:width .3s}
    
    .sentence-card{border-color:rgba(189,147,249,.15)}
    @media(hover:hover) and (pointer:fine){.sentence-card:hover{border-color:var(--purple);box-shadow:inset 0 1px 0 rgba(255,255,255,.1),inset 0 -4px 12px rgba(0,0,0,.3),0 8px 24px rgba(0,0,0,.4),0 0 20px rgba(189,147,249,.25)}}
    .sentence-card:active{border-color:var(--purple);box-shadow:inset 0 1px 0 rgba(255,255,255,.1),inset 0 -4px 12px rgba(0,0,0,.3),0 4px 16px rgba(0,0,0,.4),0 0 15px rgba(189,147,249,.25)}
    .sentence-card .category-name{color:var(--purple)}
    .sentence-review{border-color:rgba(189,147,249,.1)}
    @media(hover:hover) and (pointer:fine){.sentence-review:hover{border-color:var(--purple)}}
    .sentence-review:active{border-color:var(--purple)}
    
    .review-buttons{display:flex;gap:.5rem;margin-top:1rem}
    
    .clear-btn{background:transparent;border:1px solid rgba(255,217,61,.4);color:var(--warn);padding:.35rem .7rem;font-family:inherit;font-size:.55rem;text-transform:uppercase;letter-spacing:.05em;cursor:pointer;border-radius:4px;transition:all .3s}
    .clear-btn:hover{background:var(--warn);color:var(--bg);box-shadow:0 0 20px rgba(255,217,61,.4)}
    
    /* Quiz Session */
    .quiz-session{display:none;flex-direction:column;flex:1}
    .quiz-session.active{display:flex}
    .main-menu.hidden{display:none}
    
    .back-btn{position:absolute;top:2rem;left:2rem;background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.1);color:var(--muted);padding:.5rem 1rem;font-family:inherit;font-size:.65rem;cursor:pointer;border-radius:6px;transition:all .3s;box-shadow:inset 0 1px 0 rgba(255,255,255,.05)}
    .back-btn:hover{border-color:var(--light);color:var(--light);box-shadow:inset 0 1px 0 rgba(255,255,255,.1),0 0 15px rgba(255,255,255,.1)}
    
    header{text-align:center;margin-bottom:1rem}
    header h1{font-size:1.1rem;letter-spacing:.2em;text-transform:uppercase;color:var(--accent);text-shadow:0 0 30px var(--glow)}
    .session-subtitle{font-size:.65rem;color:var(--muted);margin-top:.3rem}
    .progress-bar{width:100%;height:4px;background:rgba(255,255,255,.06);border-radius:4px;overflow:hidden;margin:1rem 0 .5rem}
    .progress-fill{height:100%;border-radius:4px;background:linear-gradient(90deg,var(--accent),var(--purple),var(--ok));background-size:200% 100%;box-shadow:0 0 12px rgba(233,69,96,.4);transition:width .4s ease-out;animation:gradientShift 3s ease infinite}
    @keyframes gradientShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    .stats{display:flex;justify-content:center;gap:2rem;font-size:.7rem;color:var(--muted)}
    .stats span{display:flex;align-items:center;gap:.3rem}
    .stats .correct{color:var(--ok)}
    .stats .wrong{color:var(--wrong)}
    
    /* Quiz Card - shared base */
    .quiz-area{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:1rem 0}
    .quiz-card{width:100%;max-width:420px;background:linear-gradient(165deg,rgba(26,26,46,.95),rgba(10,10,15,.98));border:1px solid rgba(255,255,255,.08);border-radius:20px;padding:2rem 1.8rem;text-align:center;position:relative;box-shadow:inset 0 1px 0 rgba(255,255,255,.1),inset 0 -20px 40px rgba(0,0,0,.25),0 20px 50px rgba(0,0,0,.5),0 0 30px rgba(233,69,96,.08);animation:cardEntrance .5s ease-out}
    @keyframes cardEntrance{from{opacity:0;transform:translateY(20px) scale(.97)}to{opacity:1;transform:translateY(0) scale(1)}}
    .quiz-card::before{content:'';position:absolute;inset:0;border-radius:20px;padding:1px;background:linear-gradient(165deg,rgba(255,255,255,.12),transparent 40%,transparent);-webkit-mask:linear-gradient(#fff 0 0) content-box,linear-gradient(#fff 0 0);-webkit-mask-composite:xor;mask-composite:exclude;pointer-events:none}
    
    .audio-btn{position:absolute;top:1.2rem;right:1.2rem;background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.1);color:var(--muted);width:40px;height:40px;border-radius:50%;cursor:pointer;transition:all .3s;display:flex;align-items:center;justify-content:center;font-size:1.1rem;box-shadow:inset 0 1px 0 rgba(255,255,255,.08)}
    .audio-btn:hover{border-color:var(--accent);color:var(--accent);box-shadow:inset 0 1px 0 rgba(255,255,255,.1),0 0 20px var(--glow)}
    .audio-btn.playing{border-color:var(--ok);color:var(--ok);animation:pulse 1s infinite}
    @keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(100,255,218,.4)}50%{box-shadow:0 0 0 10px rgba(100,255,218,0)}}
    
    .card-label{position:absolute;top:1.2rem;left:1.2rem;font-size:.55rem;color:var(--purple);text-transform:uppercase;letter-spacing:.1em;opacity:.8}
    
    /* Vocab card text */
    .pinyin{font-size:2.8rem;font-weight:700;margin-bottom:.6rem;background:linear-gradient(135deg,#fff 0%,#c8c8c8 50%,#fff 100%);background-size:200% 200%;-webkit-background-clip:text;-webkit-text-fill-color:transparent;line-height:1.2;animation:shimmer 4s ease-in-out infinite}
    @keyframes shimmer{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    .chinese{font-family:'Noto Sans SC',sans-serif;font-size:1.2rem;color:var(--accent);opacity:.7;margin-bottom:1.8rem;text-shadow:0 0 15px rgba(233,69,96,.2)}
    
    /* Sentence-specific styles - pinyin hero */
    .quiz-card.sentence-mode .pinyin{font-size:1.8rem;line-height:1.5;margin-bottom:1rem}
    .quiz-card.sentence-mode .chinese{font-size:.95rem;opacity:.5;margin-bottom:1.5rem}
    
    /* Sentence inner container for depth */
    .sentence-container{background:linear-gradient(180deg,rgba(0,0,0,.15),rgba(0,0,0,.25));border-radius:12px;padding:1.2rem 1rem;margin-bottom:1.5rem;position:relative;box-shadow:inset 0 2px 8px rgba(0,0,0,.3),inset 0 -1px 0 rgba(255,255,255,.03)}
    .sentence-container::before{content:'';position:absolute;inset:0;border-radius:12px;padding:1px;background:linear-gradient(180deg,rgba(255,255,255,.04),transparent);-webkit-mask:linear-gradient(#fff 0 0) content-box,linear-gradient(#fff 0 0);-webkit-mask-composite:xor;mask-composite:exclude;pointer-events:none}
    
    .blank-box{display:inline-block;min-width:2.5em;border-bottom:2px dashed rgba(189,147,249,.5);margin:0 .15em;padding:0 .2em;transition:all .3s;position:relative}
    .blank-box::before{content:'';position:absolute;bottom:-4px;left:0;right:0;height:8px;background:radial-gradient(ellipse at center,rgba(189,147,249,.2),transparent);opacity:0;transition:opacity .3s}
    .quiz-card:not(.answered) .blank-box::before{animation:blankPulse 2s ease-in-out infinite}
    @keyframes blankPulse{0%,100%{opacity:0}50%{opacity:1}}
    .blank-box.filled{border-bottom-color:var(--ok);border-bottom-style:solid}
    .blank-box.filled::before{display:none}
    .blank-answer{color:var(--ok);font-weight:700;animation:answerAppear .4s ease-out}
    @keyframes answerAppear{0%{opacity:0;transform:translateY(4px)}100%{opacity:1;transform:translateY(0)}}
    
    .chinese-transform{animation:transformToEnglish .6s ease-out}
    .english-reveal{font-size:1rem;color:var(--purple);font-style:italic;opacity:.9;animation:englishAppear .5s ease-out}
    @keyframes transformToEnglish{0%{opacity:1;transform:translateY(0) scale(1)}40%{opacity:0;transform:translateY(-8px) scale(.98)}60%{opacity:0;transform:translateY(8px) scale(.98)}100%{opacity:1;transform:translateY(0) scale(1)}}
    @keyframes englishAppear{0%{opacity:0}100%{opacity:.9}}
    
    /* Answer buttons */
    .answers{display:flex;flex-direction:column;gap:.6rem}
    .answer-btn{background:linear-gradient(165deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid rgba(255,255,255,.08);color:var(--light);padding:.85rem 1.2rem;font-family:inherit;font-size:.85rem;cursor:pointer;border-radius:10px;transition:all .12s;text-align:left;box-shadow:inset 0 1px 0 rgba(255,255,255,.05),inset 0 -2px 6px rgba(0,0,0,.15)}
    .answer-btn:disabled{cursor:default}
    /* Hover only for devices with mouse */
    @media(hover:hover) and (pointer:fine){.answer-btn:hover:not(:disabled){border-color:var(--accent);background:linear-gradient(165deg,rgba(233,69,96,.1),rgba(233,69,96,.05));box-shadow:inset 0 1px 0 rgba(255,255,255,.1),0 0 15px rgba(233,69,96,.15)}}
    /* Active/tap state for all devices */
    .answer-btn:active:not(:disabled){border-color:var(--accent);background:linear-gradient(165deg,rgba(233,69,96,.15),rgba(233,69,96,.08));box-shadow:inset 0 1px 0 rgba(255,255,255,.1),0 0 20px rgba(233,69,96,.25);transform:scale(.98)}
    .answer-btn.correct{border-color:var(--ok);background:linear-gradient(165deg,rgba(100,255,218,.12),rgba(100,255,218,.06));color:var(--ok);box-shadow:inset 0 1px 0 rgba(255,255,255,.1),0 0 20px rgba(100,255,218,.25);animation:correctPop .4s ease-out}
    @keyframes correctPop{0%{transform:scale(1)}50%{transform:scale(1.015)}100%{transform:scale(1)}}
    .answer-btn.wrong{border-color:var(--wrong);background:linear-gradient(165deg,rgba(255,107,107,.12),rgba(255,107,107,.06));color:var(--wrong);box-shadow:inset 0 1px 0 rgba(255,255,255,.1),0 0 15px rgba(255,107,107,.2);animation:wrongShake .4s ease-out}
    @keyframes wrongShake{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-4px)}40%,80%{transform:translateX(4px)}}
    .answer-btn.reveal{border-color:var(--ok);opacity:.5}
    
    .feedback{margin-top:1.2rem;font-size:.75rem;min-height:1.2rem}
    .feedback.correct{color:var(--ok);text-shadow:0 0 12px rgba(100,255,218,.3)}
    .feedback.wrong{color:var(--wrong);text-shadow:0 0 12px rgba(255,107,107,.3)}
    
    .next-btn{margin-top:1.2rem;background:linear-gradient(145deg,var(--accent),#c13a52);border:none;color:#fff;padding:.7rem 1.8rem;font-family:inherit;font-size:.75rem;letter-spacing:.1em;text-transform:uppercase;cursor:pointer;border-radius:8px;transition:all .3s;display:none;box-shadow:inset 0 1px 0 rgba(255,255,255,.2),0 4px 15px rgba(233,69,96,.35)}
    .next-btn.show{display:inline-block;animation:fadeInUp .3s ease-out}
    @keyframes fadeInUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
    .next-btn:hover{box-shadow:inset 0 1px 0 rgba(255,255,255,.2),0 6px 25px rgba(233,69,96,.5),0 0 30px var(--glow);transform:translateY(-2px)}
    
    .keyboard-hint{text-align:center;margin-top:1.2rem;font-size:.6rem;color:var(--muted);opacity:.7;display:none}
    @media(hover:hover) and (pointer:fine){.keyboard-hint{display:block}}
    kbd{background:rgba(255,255,255,.06);padding:.15rem .4rem;border-radius:3px;margin:0 .15rem;border:1px solid rgba(255,255,255,.08);font-size:.7rem}
    
    /* Complete Screen */
    .complete-screen{display:none;text-align:center;padding:2rem;flex:1;flex-direction:column;justify-content:center;align-items:center}
    .complete-screen.show{display:flex;animation:fadeInUp .5s ease-out}
    .complete-screen h2{font-size:1.8rem;color:var(--ok);margin-bottom:1.5rem;text-shadow:0 0 25px rgba(100,255,218,.3)}
    .complete-stats{display:flex;gap:1.5rem;margin-bottom:1rem;flex-wrap:wrap;justify-content:center}
    .complete-stat{text-align:center;padding:.9rem 1.3rem;background:linear-gradient(165deg,rgba(26,26,46,.6),rgba(15,15,26,.8));border-radius:10px;border:1px solid rgba(255,255,255,.05);box-shadow:inset 0 1px 0 rgba(255,255,255,.05),inset 0 -6px 15px rgba(0,0,0,.2)}
    .complete-stat .value{font-size:1.8rem;font-weight:700}
    .complete-stat .value.good{color:var(--ok);text-shadow:0 0 15px rgba(100,255,218,.3)}
    .complete-stat .value.bad{color:var(--wrong);text-shadow:0 0 15px rgba(255,107,107,.3)}
    .complete-stat .label{font-size:.6rem;color:var(--muted);text-transform:uppercase;letter-spacing:.05em}
    .review-notice{font-size:.8rem;color:var(--warn);margin:1rem 0 1.5rem;text-shadow:0 0 12px rgba(255,217,61,.2)}
    .complete-buttons{display:flex;gap:.8rem;justify-content:center;flex-wrap:wrap}
    .menu-btn,.restart-btn,.review-btn{padding:.8rem 1.6rem;font-family:inherit;font-size:.7rem;letter-spacing:.12em;text-transform:uppercase;cursor:pointer;border-radius:8px;transition:all .3s}
    .menu-btn{background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.1);color:var(--light);box-shadow:inset 0 1px 0 rgba(255,255,255,.05)}
    .menu-btn:hover{border-color:var(--light);box-shadow:inset 0 1px 0 rgba(255,255,255,.1),0 0 15px rgba(255,255,255,.1)}
    .restart-btn{background:linear-gradient(145deg,var(--accent),#c13a52);border:none;color:#fff;box-shadow:inset 0 1px 0 rgba(255,255,255,.2),0 4px 15px rgba(233,69,96,.3)}
    .restart-btn:hover{box-shadow:inset 0 1px 0 rgba(255,255,255,.2),0 6px 25px rgba(233,69,96,.5),0 0 25px var(--glow)}
    .review-btn{background:linear-gradient(145deg,var(--purple),#9b6dd4);border:none;color:#fff;box-shadow:inset 0 1px 0 rgba(255,255,255,.2),0 4px 15px rgba(189,147,249,.3)}
    .review-btn:hover{box-shadow:inset 0 1px 0 rgba(255,255,255,.2),0 6px 25px rgba(189,147,249,.5)}
    
    /* Responsive */
    @media(max-width:600px){
      .container{padding:1rem}
      .menu-header h1{font-size:1.6rem}
      .category-grid{grid-template-columns:1fr 1fr}
      .level-header{flex-wrap:wrap}
      .play-all-btn{margin:1rem 0 0;width:100%}
      .quiz-card{padding:1.5rem 1.2rem}
      .pinyin{font-size:2.2rem}
      .quiz-card.sentence-mode .pinyin{font-size:1.4rem}
    }
  </style>
</head>
<body>
  <!-- Splash Screen -->
  <div class="splash" id="splash">
    <div class="splash-logo">ä¸­</div>
    <div class="splash-text">Loading</div>
  </div>
  
  <div class="container">
    <!-- Main Menu -->
    <div class="main-menu" id="main-menu">
      <div class="menu-header">
        <button type="button" class="settings-btn" id="settings-btn" title="Settings">âš™</button>
        <h1>ä¸­æ–‡ Chinese</h1>
        <div class="global-stats">
          <div class="global-stat">
            <div class="value" id="total-mastered">0</div>
            <div class="label">Words Mastered</div>
          </div>
          <div class="global-stat">
            <div class="value" id="total-accuracy">0%</div>
            <div class="label">Accuracy</div>
          </div>
          <div class="global-stat">
            <div class="value" id="total-attempts">0</div>
            <div class="label">Total Attempts</div>
          </div>
        </div>
      </div>
      <div class="menu-sections" id="menu-sections"></div>
    </div>
    
    <!-- Settings Modal -->
    <div class="modal-overlay" id="settings-modal">
      <div class="modal">
        <h2>âš™ Settings</h2>
        <div class="modal-section">
          <h3>Reset by Level</h3>
          <button type="button" class="reset-btn" data-level="1">
            <span class="level-name">Level 1</span>
            <span class="level-info" id="reset-info-1">0 words, 0 sentences</span>
          </button>
          <button type="button" class="reset-btn" data-level="2">
            <span class="level-name">Level 2</span>
            <span class="level-info" id="reset-info-2">0 words, 0 sentences</span>
          </button>
          <button type="button" class="reset-btn" data-level="3">
            <span class="level-name">Level 3</span>
            <span class="level-info" id="reset-info-3">0 words, 0 sentences</span>
          </button>
          <button type="button" class="reset-btn" data-level="4">
            <span class="level-name">Level 4</span>
            <span class="level-info" id="reset-info-4">0 words, 0 sentences</span>
          </button>
        </div>
        <div class="modal-section">
          <h3>Reset Everything</h3>
          <button type="button" class="reset-btn reset-all-btn" id="reset-all-btn">
            <span class="level-name">Reset All Progress</span>
            <span class="level-info">Words, sentences, stats</span>
          </button>
        </div>
        <button type="button" class="modal-close" id="modal-close">Close</button>
      </div>
    </div>
    
    <!-- Quiz Session -->
    <div class="quiz-session" id="quiz-session">
      <button type="button" class="back-btn" id="back-btn">â† Menu</button>
      <header>
        <h1 id="session-title">Level 1</h1>
        <p class="session-subtitle" id="session-subtitle">Common Adjectives</p>
        <div class="progress-bar"><div class="progress-fill" id="progress"></div></div>
        <div class="stats">
          <span id="current-count">1 / 10</span>
          <span class="correct">âœ“ <span id="correct-count">0</span></span>
          <span class="wrong">âœ— <span id="wrong-count">0</span></span>
        </div>
      </header>
      
      <div class="quiz-area" id="quiz-area">
        <div class="quiz-card">
          <span class="card-label" id="card-label">Adjectives</span>
          <button type="button" class="audio-btn" id="audio-btn" title="Play audio">ğŸ”Š</button>
          <div class="pinyin" id="pinyin">nÇ hÇo</div>
          <div class="chinese" id="chinese">ä½ å¥½</div>
          <div class="answers" id="answers"></div>
          <div class="feedback" id="feedback"></div>
          <button type="button" class="next-btn" id="next-btn">Next â†’</button>
        </div>
        <div class="keyboard-hint">
          <kbd>1</kbd><kbd>2</kbd><kbd>3</kbd> select Â· <kbd>Enter</kbd> next Â· <kbd>Space</kbd> replay audio
        </div>
      </div>
      
      <div class="complete-screen" id="complete-screen">
        <h2>âœ¨ Session Complete!</h2>
        <div class="complete-stats">
          <div class="complete-stat">
            <div class="value good" id="final-correct">0</div>
            <div class="label">Correct</div>
          </div>
          <div class="complete-stat">
            <div class="value bad" id="final-wrong">0</div>
            <div class="label">Wrong</div>
          </div>
          <div class="complete-stat">
            <div class="value" id="final-accuracy" style="color:var(--purple)">0%</div>
            <div class="label">Accuracy</div>
          </div>
        </div>
        <p class="review-notice" id="review-notice"></p>
        <div class="complete-buttons">
          <button type="button" class="menu-btn" id="menu-btn">Back to Menu</button>
          <button type="button" class="restart-btn" id="restart-btn">Play Again</button>
          <button type="button" class="review-btn" id="study-review-btn" style="display:none">Study Review</button>
        </div>
      </div>
    </div>
  </div>

<script>
// ============ VOCABULARY DATA ============
const VOCAB_DATA = {
  "1": {
    "Common Adjectives": [
      {"p": "hÇo", "c": "å¥½", "e": "good"},
      {"p": "mÃ¡ng", "c": "å¿™", "e": "busy"},
      {"p": "lÃ¨i", "c": "ç´¯", "e": "tired"},
      {"p": "Ã¨", "c": "é¥¿", "e": "hungry"},
      {"p": "kÄ›", "c": "æ¸´", "e": "thirsty"},
      {"p": "kÃ¹n", "c": "å›°", "e": "sleepy"},
      {"p": "lÇn", "c": "æ‡’", "e": "lazy"},
      {"p": "zÇo", "c": "æ—©", "e": "early"},
      {"p": "wÇn", "c": "æ™š", "e": "late"},
      {"p": "dÃ ", "c": "å¤§", "e": "big / large"},
      {"p": "xiÇo", "c": "å°", "e": "small / little"},
      {"p": "duÅ", "c": "å¤š", "e": "many / much"},
      {"p": "shÇo", "c": "å°‘", "e": "few / little"},
      {"p": "gÄo", "c": "é«˜", "e": "tall / high"},
      {"p": "piÃ oliang", "c": "æ¼‚äº®", "e": "beautiful / pretty"},
      {"p": "shuÃ i", "c": "å¸…", "e": "handsome"},
      {"p": "lÄ›ng", "c": "å†·", "e": "cold"},
      {"p": "rÃ¨", "c": "çƒ­", "e": "hot"},
      {"p": "xÄ«n", "c": "æ–°", "e": "new"},
      {"p": "kuÃ i", "c": "å¿«", "e": "fast / quick"},
      {"p": "mÃ n", "c": "æ…¢", "e": "slow"},
      {"p": "guÃ¬", "c": "è´µ", "e": "expensive"},
      {"p": "piÃ¡nyi", "c": "ä¾¿å®œ", "e": "cheap"},
      {"p": "jÃ¬n", "c": "è¿‘", "e": "near / close"},
      {"p": "yuÇn", "c": "è¿œ", "e": "far"},
      {"p": "nÃ¡n", "c": "éš¾", "e": "difficult"},
      {"p": "rÃ³ngyÃ¬", "c": "å®¹æ˜“", "e": "easy"},
      {"p": "gÄoxÃ¬ng", "c": "é«˜å…´", "e": "happy / glad"},
      {"p": "hÇochÄ«", "c": "å¥½åƒ", "e": "delicious"}
    ],
    "Degree Adverbs": [
      {"p": "hÄ›n", "c": "å¾ˆ", "e": "very"},
      {"p": "yÄ›", "c": "ä¹Ÿ", "e": "also"},
      {"p": "dÅu", "c": "éƒ½", "e": "all / both"},
      {"p": "fÄ“ichÃ¡ng", "c": "éå¸¸", "e": "extremely"},
      {"p": "tÃ i...le", "c": "å¤ª...äº†", "e": "too (much)"},
      {"p": "yÇ’u diÇn", "c": "æœ‰ç‚¹", "e": "a little (negative)"},
      {"p": "bÃ¹ tÃ i", "c": "ä¸å¤ª", "e": "not very"},
      {"p": "zhÄ“n", "c": "çœŸ", "e": "really / truly"},
      {"p": "zuÃ¬", "c": "æœ€", "e": "most / -est"},
      {"p": "hÃ¡i", "c": "è¿˜", "e": "still / also"},
      {"p": "gÃ¨ng", "c": "æ›´", "e": "even more"},
      {"p": "jiÃ¹", "c": "å°±", "e": "then / just"},
      {"p": "cÃ¡i", "c": "æ‰", "e": "only then / just"}
    ],
    "Common Verbs": [
      {"p": "chÄ«", "c": "åƒ", "e": "to eat"},
      {"p": "hÄ“", "c": "å–", "e": "to drink"},
      {"p": "qÃ¹", "c": "å»", "e": "to go"},
      {"p": "lÃ¡i", "c": "æ¥", "e": "to come"},
      {"p": "kÃ n", "c": "çœ‹", "e": "to look / watch / read"},
      {"p": "tÄ«ng", "c": "å¬", "e": "to listen"},
      {"p": "xiÇng", "c": "æƒ³", "e": "to want / think / miss"},
      {"p": "yÃ o", "c": "è¦", "e": "to want / need / will"},
      {"p": "xÇhuan", "c": "å–œæ¬¢", "e": "to like"},
      {"p": "Ã i", "c": "çˆ±", "e": "to love"},
      {"p": "zhÄ«dÃ o", "c": "çŸ¥é“", "e": "to know (fact)"},
      {"p": "juÃ©de", "c": "è§‰å¾—", "e": "to feel / think"},
      {"p": "shuÅ", "c": "è¯´", "e": "to speak / say"},
      {"p": "zuÃ²", "c": "å", "e": "to sit"},
      {"p": "zhÃ n", "c": "ç«™", "e": "to stand"},
      {"p": "zÇ’u", "c": "èµ°", "e": "to walk"},
      {"p": "shÃ¬", "c": "æ˜¯", "e": "to be"},
      {"p": "yÇ’u", "c": "æœ‰", "e": "to have"},
      {"p": "mÃ©i yÇ’u", "c": "æ²¡æœ‰", "e": "to not have"},
      {"p": "zÃ i", "c": "åœ¨", "e": "to be at / in"},
      {"p": "gÄ›i", "c": "ç»™", "e": "to give"},
      {"p": "mÇi", "c": "ä¹°", "e": "to buy"},
      {"p": "mÃ i", "c": "å–", "e": "to sell"},
      {"p": "dÄ›ng", "c": "ç­‰", "e": "to wait"},
      {"p": "wÃ¨n", "c": "é—®", "e": "to ask"},
      {"p": "dÃ¡", "c": "ç­”", "e": "to answer"},
      {"p": "huÃ­", "c": "å›", "e": "to return"},
      {"p": "huÃ­dÃ¡", "c": "å›ç­”", "e": "to reply"},
      {"p": "dÇ diÃ nhuÃ ", "c": "æ‰“ç”µè¯", "e": "to make a call"},
      {"p": "kÄi", "c": "å¼€", "e": "to open / turn on"},
      {"p": "guÄn", "c": "å…³", "e": "to close / turn off"},
      {"p": "shuÃ¬ jiÃ o", "c": "ç¡è§‰", "e": "to sleep"},
      {"p": "qÇ chuÃ¡ng", "c": "èµ·åºŠ", "e": "to get up"},
      {"p": "xuÃ©", "c": "å­¦", "e": "to study"},
      {"p": "xuÃ©xÃ­", "c": "å­¦ä¹ ", "e": "to learn"},
      {"p": "gÅngzuÃ²", "c": "å·¥ä½œ", "e": "to work"},
      {"p": "xiÅ«xi", "c": "ä¼‘æ¯", "e": "to rest"},
      {"p": "wÃ¡n", "c": "ç©", "e": "to play"}
    ],
    "Question Words": [
      {"p": "shÃ©nme", "c": "ä»€ä¹ˆ", "e": "what?"},
      {"p": "shÃ©i", "c": "è°", "e": "who?"},
      {"p": "nÇlÇ", "c": "å“ªé‡Œ", "e": "where?"},
      {"p": "nÇ", "c": "å“ª", "e": "which?"},
      {"p": "ne", "c": "å‘¢", "e": "how about...?"},
      {"p": "wÃ¨ishÃ©nme", "c": "ä¸ºä»€ä¹ˆ", "e": "why?"},
      {"p": "zÄ›nme", "c": "æ€ä¹ˆ", "e": "how?"},
      {"p": "duÅshao", "c": "å¤šå°‘", "e": "how much / how many?"},
      {"p": "jÇ", "c": "å‡ ", "e": "how many? (small number)"}
    ],
    "Family & People": [
      {"p": "bÃ ba", "c": "çˆ¸çˆ¸", "e": "dad"},
      {"p": "mÄma", "c": "å¦ˆå¦ˆ", "e": "mom"},
      {"p": "gÄ“ge", "c": "å“¥å“¥", "e": "older brother"},
      {"p": "jiÄ›jie", "c": "å§å§", "e": "older sister"},
      {"p": "dÃ¬di", "c": "å¼Ÿå¼Ÿ", "e": "younger brother"},
      {"p": "mÃ¨imei", "c": "å¦¹å¦¹", "e": "younger sister"},
      {"p": "hÃ¡izi", "c": "å­©å­", "e": "child"},
      {"p": "Ã©rzi", "c": "å„¿å­", "e": "son"},
      {"p": "nÇš'Ã©r", "c": "å¥³å„¿", "e": "daughter"},
      {"p": "zhÃ ngfu", "c": "ä¸ˆå¤«", "e": "husband"},
      {"p": "qÄ«zi", "c": "å¦»å­", "e": "wife"},
      {"p": "pÃ©ngyou", "c": "æœ‹å‹", "e": "friend"},
      {"p": "jiÄrÃ©n", "c": "å®¶äºº", "e": "family members"},
      {"p": "fÃ¹mÇ”", "c": "çˆ¶æ¯", "e": "parents"}
    ],
    "Colors": [
      {"p": "yÃ¡nsÃ¨", "c": "é¢œè‰²", "e": "color"},
      {"p": "hÃ³ng", "c": "çº¢", "e": "red"},
      {"p": "huÃ¡ng", "c": "é»„", "e": "yellow"},
      {"p": "lÃ¡n", "c": "è“", "e": "blue"},
      {"p": "lÇœ", "c": "ç»¿", "e": "green"},
      {"p": "bÃ¡i", "c": "ç™½", "e": "white"},
      {"p": "hÄ“i", "c": "é»‘", "e": "black"},
      {"p": "fÄ›n", "c": "ç²‰", "e": "pink"},
      {"p": "zÇ", "c": "ç´«", "e": "purple"},
      {"p": "huÄ«", "c": "ç°", "e": "gray"},
      {"p": "chÃ©ng", "c": "æ©™", "e": "orange"}
    ],
    "Numbers (Extended)": [
      {"p": "bÇi", "c": "ç™¾", "e": "hundred"},
      {"p": "qiÄn", "c": "åƒ", "e": "thousand"},
      {"p": "wÃ n", "c": "ä¸‡", "e": "ten thousand"},
      {"p": "liÇng", "c": "ä¸¤", "e": "two (before measure words)"},
      {"p": "dÃ¬yÄ«", "c": "ç¬¬ä¸€", "e": "first"},
      {"p": "dÃ¬'Ã¨r", "c": "ç¬¬äºŒ", "e": "second"},
      {"p": "dÃ¬sÄn", "c": "ç¬¬ä¸‰", "e": "third"}
    ]
  },
  "2": {
    "Basic Time Words": [
      {"p": "jÄ«ntiÄn", "c": "ä»Šå¤©", "e": "today"},
      {"p": "mÃ­ngtiÄn", "c": "æ˜å¤©", "e": "tomorrow"},
      {"p": "zuÃ³tiÄn", "c": "æ˜¨å¤©", "e": "yesterday"},
      {"p": "xiÃ nzÃ i", "c": "ç°åœ¨", "e": "now"},
      {"p": "zÇoshang", "c": "æ—©ä¸Š", "e": "morning (early)"},
      {"p": "shÃ ngwÇ”", "c": "ä¸Šåˆ", "e": "morning (late)"},
      {"p": "zhÅngwÇ”", "c": "ä¸­åˆ", "e": "noon"},
      {"p": "xiÃ wÇ”", "c": "ä¸‹åˆ", "e": "afternoon"},
      {"p": "wÇnshang", "c": "æ™šä¸Š", "e": "evening"},
      {"p": "yÃ¨lÇ", "c": "å¤œé‡Œ", "e": "night"},
      {"p": "bÃ nyÃ¨", "c": "åŠå¤œ", "e": "midnight"}
    ],
    "Telling Time": [
      {"p": "diÇn", "c": "ç‚¹", "e": "o'clock"},
      {"p": "bÃ n", "c": "åŠ", "e": "half (past)"},
      {"p": "fÄ“n", "c": "åˆ†", "e": "minute"},
      {"p": "fÄ“nzhÅng", "c": "åˆ†é’Ÿ", "e": "minute (duration)"},
      {"p": "kÃ¨", "c": "åˆ»", "e": "quarter (15 min)"},
      {"p": "liÇng diÇn", "c": "ä¸¤ç‚¹", "e": "2 o'clock (use liÇng!)"},
      {"p": "jÇ diÇn", "c": "å‡ ç‚¹", "e": "what time?"},
      {"p": "xiÇoshÃ­", "c": "å°æ—¶", "e": "hour"}
    ],
    "Modal Verbs (can/may/will)": [
      {"p": "huÃ¬", "c": "ä¼š", "e": "can (learned skill) / will"},
      {"p": "kÄ›yÇ", "c": "å¯ä»¥", "e": "can / may (permission)"},
      {"p": "nÃ©ng", "c": "èƒ½", "e": "can (capability/possibility)"},
      {"p": "kÄ›nÃ©ng", "c": "å¯èƒ½", "e": "maybe / possible"},
      {"p": "bÃ¬xÅ«", "c": "å¿…é¡»", "e": "must"},
      {"p": "yÄ«nggÄi", "c": "åº”è¯¥", "e": "should"}
    ],
    "Places & Directions": [
      {"p": "zhÃ¨lÇ", "c": "è¿™é‡Œ", "e": "here"},
      {"p": "nÃ lÇ", "c": "é‚£é‡Œ", "e": "there"},
      {"p": "jiÄ", "c": "å®¶", "e": "home / family"},
      {"p": "xuÃ©xiÃ o", "c": "å­¦æ ¡", "e": "school"},
      {"p": "bÃ ngÅngshÃ¬", "c": "åŠå…¬å®¤", "e": "office"},
      {"p": "gÅngsÄ«", "c": "å…¬å¸", "e": "company"},
      {"p": "cÃ¨suÇ’", "c": "å•æ‰€", "e": "bathroom / toilet"},
      {"p": "fÃ¡ngjiÄn", "c": "æˆ¿é—´", "e": "room"},
      {"p": "jiÃ oshÃ¬", "c": "æ•™å®¤", "e": "classroom"},
      {"p": "shÄngdiÃ n", "c": "å•†åº—", "e": "store / shop"},
      {"p": "fÃ ndiÃ n", "c": "é¥­åº—", "e": "restaurant / hotel"},
      {"p": "yÄ«yuÃ n", "c": "åŒ»é™¢", "e": "hospital"},
      {"p": "jÄ«chÇng", "c": "æœºåœº", "e": "airport"},
      {"p": "huÇ’chÄ“zhÃ n", "c": "ç«è½¦ç«™", "e": "train station"},
      {"p": "qiÃ¡n", "c": "å‰", "e": "front"},
      {"p": "hÃ²u", "c": "å", "e": "back / behind"},
      {"p": "zuÇ’", "c": "å·¦", "e": "left"},
      {"p": "yÃ²u", "c": "å³", "e": "right"},
      {"p": "shÃ ng", "c": "ä¸Š", "e": "up / on"},
      {"p": "xiÃ ", "c": "ä¸‹", "e": "down / under"},
      {"p": "lÇ", "c": "é‡Œ", "e": "inside"},
      {"p": "wÃ i", "c": "å¤–", "e": "outside"},
      {"p": "pÃ¡ngbiÄn", "c": "æ—è¾¹", "e": "beside"},
      {"p": "duÃ¬miÃ n", "c": "å¯¹é¢", "e": "opposite"}
    ],
    "Food & Drinks": [
      {"p": "shuÇ", "c": "æ°´", "e": "water"},
      {"p": "kÄfÄ“i", "c": "å’–å•¡", "e": "coffee"},
      {"p": "chÃ¡", "c": "èŒ¶", "e": "tea"},
      {"p": "niÃºnÇi", "c": "ç‰›å¥¶", "e": "milk"},
      {"p": "miÃ nbÄo", "c": "é¢åŒ…", "e": "bread"},
      {"p": "mÇfÃ n", "c": "ç±³é¥­", "e": "rice (cooked)"},
      {"p": "miÃ ntiÃ¡o", "c": "é¢æ¡", "e": "noodles"},
      {"p": "cÃ i", "c": "èœ", "e": "dish / vegetable"},
      {"p": "rÃ²u", "c": "è‚‰", "e": "meat"},
      {"p": "jÄ«", "c": "é¸¡", "e": "chicken"},
      {"p": "yÃº", "c": "é±¼", "e": "fish"},
      {"p": "jÄ«dÃ n", "c": "é¸¡è›‹", "e": "egg"},
      {"p": "shuÇguÇ’", "c": "æ°´æœ", "e": "fruit"},
      {"p": "pÃ­ngguÇ’", "c": "è‹¹æœ", "e": "apple"},
      {"p": "dÃ ngÄo", "c": "è›‹ç³•", "e": "cake"},
      {"p": "bÄ«ngqÃ­lÃ­n", "c": "å†°æ·‡æ·‹", "e": "ice cream"},
      {"p": "fÃ n", "c": "é¥­", "e": "meal / cooked rice"}
    ],
    "Polite Expressions": [
      {"p": "qÇng", "c": "è¯·", "e": "please"},
      {"p": "qÇng wÃ¨n", "c": "è¯·é—®", "e": "excuse me, may I ask..."},
      {"p": "qÇng zuÃ²", "c": "è¯·å", "e": "please sit"},
      {"p": "qÇng jÃ¬n", "c": "è¯·è¿›", "e": "please come in"},
      {"p": "nÃ­n", "c": "æ‚¨", "e": "you (formal/polite)"},
      {"p": "jiÃ¨ shÃ o", "c": "ä»‹ç»", "e": "to introduce"},
      {"p": "bÄng zhÃ¹", "c": "å¸®åŠ©", "e": "to help"}
    ],
    "Transportation": [
      {"p": "chÄ“", "c": "è½¦", "e": "vehicle / car"},
      {"p": "chÅ«zÅ«chÄ“", "c": "å‡ºç§Ÿè½¦", "e": "taxi"},
      {"p": "gÅnggÃ²ng qÃ¬chÄ“", "c": "å…¬å…±æ±½è½¦", "e": "bus"},
      {"p": "huÇ’chÄ“", "c": "ç«è½¦", "e": "train"},
      {"p": "fÄ“ijÄ«", "c": "é£æœº", "e": "airplane"},
      {"p": "zÃ¬xÃ­ngchÄ“", "c": "è‡ªè¡Œè½¦", "e": "bicycle"},
      {"p": "lÃ¹", "c": "è·¯", "e": "road"},
      {"p": "piÃ o", "c": "ç¥¨", "e": "ticket"}
    ],
    "Weather": [
      {"p": "tiÄnqÃ¬", "c": "å¤©æ°”", "e": "weather"},
      {"p": "qÃ­ng", "c": "æ™´", "e": "sunny / clear"},
      {"p": "yÄ«n", "c": "é˜´", "e": "cloudy / overcast"},
      {"p": "xiÃ  yÇ”", "c": "ä¸‹é›¨", "e": "to rain"},
      {"p": "xuÄ›", "c": "é›ª", "e": "snow"},
      {"p": "fÄ“ng", "c": "é£", "e": "wind"},
      {"p": "nuÇnhuo", "c": "æš–å’Œ", "e": "warm"},
      {"p": "liÃ¡ngkuai", "c": "å‡‰å¿«", "e": "cool (temperature)"}
    ]
  },
  "3": {
    "Extended Time Expressions": [
      {"p": "qiÃ¡ntiÄn", "c": "å‰å¤©", "e": "day before yesterday"},
      {"p": "hÃ²utiÄn", "c": "åå¤©", "e": "day after tomorrow"},
      {"p": "jÄ«nniÃ¡n", "c": "ä»Šå¹´", "e": "this year"},
      {"p": "mÃ­ngniÃ¡n", "c": "æ˜å¹´", "e": "next year"},
      {"p": "qÃ¹niÃ¡n", "c": "å»å¹´", "e": "last year"},
      {"p": "shÃ ng ge yuÃ¨", "c": "ä¸Šä¸ªæœˆ", "e": "last month"},
      {"p": "zhÃ¨ ge yuÃ¨", "c": "è¿™ä¸ªæœˆ", "e": "this month"},
      {"p": "xiÃ  ge yuÃ¨", "c": "ä¸‹ä¸ªæœˆ", "e": "next month"},
      {"p": "shÃ ng cÃ¬", "c": "ä¸Šæ¬¡", "e": "last time"},
      {"p": "zhÃ¨ cÃ¬", "c": "è¿™æ¬¡", "e": "this time"},
      {"p": "xiÃ  cÃ¬", "c": "ä¸‹æ¬¡", "e": "next time"},
      {"p": "yÇqiÃ¡n", "c": "ä»¥å‰", "e": "before / previously"},
      {"p": "yÇhÃ²u", "c": "ä»¥å", "e": "after / later"}
    ],
    "Days of the Week": [
      {"p": "xÄ«ngqÄ«", "c": "æ˜ŸæœŸ", "e": "week"},
      {"p": "xÄ«ngqÄ«yÄ«", "c": "æ˜ŸæœŸä¸€", "e": "Monday"},
      {"p": "xÄ«ngqÄ«'Ã¨r", "c": "æ˜ŸæœŸäºŒ", "e": "Tuesday"},
      {"p": "xÄ«ngqÄ«sÄn", "c": "æ˜ŸæœŸä¸‰", "e": "Wednesday"},
      {"p": "xÄ«ngqÄ«sÃ¬", "c": "æ˜ŸæœŸå››", "e": "Thursday"},
      {"p": "xÄ«ngqÄ«wÇ”", "c": "æ˜ŸæœŸäº”", "e": "Friday"},
      {"p": "xÄ«ngqÄ«liÃ¹", "c": "æ˜ŸæœŸå…­", "e": "Saturday"},
      {"p": "xÄ«ngqÄ«tiÄn", "c": "æ˜ŸæœŸå¤©", "e": "Sunday"},
      {"p": "zhÅumÃ²", "c": "å‘¨æœ«", "e": "weekend"}
    ],
    "Action Verbs": [
      {"p": "zuÃ²", "c": "åš", "e": "to do / to make"},
      {"p": "zuÃ² fÃ n", "c": "åšé¥­", "e": "to cook"},
      {"p": "rÃ¨nshi", "c": "è®¤è¯†", "e": "to know (a person)"},
      {"p": "jiÃ n", "c": "è§", "e": "to see / meet"},
      {"p": "kÃ njiÃ n", "c": "çœ‹è§", "e": "to see (perceive)"},
      {"p": "jiÄ“", "c": "æ¥", "e": "to pick up (someone)"},
      {"p": "dÃ i", "c": "å¸¦", "e": "to take/bring (someone)"},
      {"p": "pÇo", "c": "è·‘", "e": "to run"},
      {"p": "pÇobÃ¹", "c": "è·‘æ­¥", "e": "to jog"},
      {"p": "yÃ³uyÇ’ng", "c": "æ¸¸æ³³", "e": "to swim"},
      {"p": "chÃ ng gÄ“", "c": "å”±æ­Œ", "e": "to sing"},
      {"p": "tiÃ o wÇ”", "c": "è·³èˆ", "e": "to dance"},
      {"p": "huÃ ", "c": "ç”»", "e": "to draw / paint"},
      {"p": "zhÇo", "c": "æ‰¾", "e": "to look for"},
      {"p": "xiÄ›", "c": "å†™", "e": "to write"},
      {"p": "dÃº", "c": "è¯»", "e": "to read aloud"},
      {"p": "jiÄo", "c": "æ•™", "e": "to teach"},
      {"p": "bÄng", "c": "å¸®", "e": "to help"},
      {"p": "shÅu", "c": "æ”¶", "e": "to receive / collect"},
      {"p": "sÃ²ng", "c": "é€", "e": "to give (as gift) / deliver"},
      {"p": "chuÄn", "c": "ç©¿", "e": "to wear"},
      {"p": "dÃ i", "c": "æˆ´", "e": "to wear (accessories)"},
      {"p": "xÇ", "c": "æ´—", "e": "to wash"},
      {"p": "kÅ«", "c": "å“­", "e": "to cry"},
      {"p": "xiÃ o", "c": "ç¬‘", "e": "to laugh / smile"},
      {"p": "wÃ ng", "c": "å¿˜", "e": "to forget"},
      {"p": "jÃ¬de", "c": "è®°å¾—", "e": "to remember"},
      {"p": "dÇ’ng", "c": "æ‡‚", "e": "to understand"},
      {"p": "xÄ«wÃ ng", "c": "å¸Œæœ›", "e": "to hope"},
      {"p": "zhÇ”nbÃ¨i", "c": "å‡†å¤‡", "e": "to prepare"},
      {"p": "kÄishÇ", "c": "å¼€å§‹", "e": "to begin"},
      {"p": "jiÃ©shÃ¹", "c": "ç»“æŸ", "e": "to end"},
      {"p": "wÃ¡nchÃ©ng", "c": "å®Œæˆ", "e": "to finish / complete"}
    ],
    "Agreement & Response Words": [
      {"p": "hÇo de", "c": "å¥½çš„", "e": "okay (polite)"},
      {"p": "hÇo a", "c": "å¥½å•Š", "e": "sure! (enthusiastic)"},
      {"p": "tÃ i hÇo le", "c": "å¤ªå¥½äº†", "e": "great! / awesome!"},
      {"p": "xÃ­ng", "c": "è¡Œ", "e": "fine / that works"},
      {"p": "shÃ¬ de", "c": "æ˜¯çš„", "e": "yes (emphatic)"},
      {"p": "hÇo ma?", "c": "å¥½å—ï¼Ÿ", "e": "is that okay?"},
      {"p": "kÄ›yÇ ma?", "c": "å¯ä»¥å—ï¼Ÿ", "e": "can we? / is it allowed?"},
      {"p": "kuÃ ilÃ¨", "c": "å¿«ä¹", "e": "happy / joyful"},
      {"p": "duÃ¬", "c": "å¯¹", "e": "correct / right"},
      {"p": "cuÃ²", "c": "é”™", "e": "wrong / incorrect"},
      {"p": "mÃ©i wÃ¨ntÃ­", "c": "æ²¡é—®é¢˜", "e": "no problem"},
      {"p": "dÄngrÃ¡n", "c": "å½“ç„¶", "e": "of course"}
    ],
    "People & Relationships": [
      {"p": "rÃ©n", "c": "äºº", "e": "person"},
      {"p": "nÃ¡n", "c": "ç”·", "e": "male"},
      {"p": "nÇš", "c": "å¥³", "e": "female"},
      {"p": "nÃ¡n pÃ©ngyou", "c": "ç”·æœ‹å‹", "e": "boyfriend"},
      {"p": "nÇš pÃ©ngyou", "c": "å¥³æœ‹å‹", "e": "girlfriend"},
      {"p": "tÃ³ngshÃ¬", "c": "åŒäº‹", "e": "colleague"},
      {"p": "tÃ³ngxuÃ©", "c": "åŒå­¦", "e": "classmate"},
      {"p": "lÇoshÄ«", "c": "è€å¸ˆ", "e": "teacher"},
      {"p": "xuÃ©sheng", "c": "å­¦ç”Ÿ", "e": "student"},
      {"p": "yÄ«shÄ“ng", "c": "åŒ»ç”Ÿ", "e": "doctor"},
      {"p": "sÄ«jÄ«", "c": "å¸æœº", "e": "driver"},
      {"p": "fÃºwÃ¹yuÃ¡n", "c": "æœåŠ¡å‘˜", "e": "waiter/waitress"},
      {"p": "lÇobÇn", "c": "è€æ¿", "e": "boss"},
      {"p": "kÃ¨rÃ©n", "c": "å®¢äºº", "e": "guest / customer"}
    ],
    "Common Objects": [
      {"p": "dÅngxi", "c": "ä¸œè¥¿", "e": "thing / stuff"},
      {"p": "shÅ«", "c": "ä¹¦", "e": "book"},
      {"p": "bÃ ozhÇ", "c": "æŠ¥çº¸", "e": "newspaper"},
      {"p": "shÇ’ujÄ«", "c": "æ‰‹æœº", "e": "cellphone"},
      {"p": "diÃ nnÇo", "c": "ç”µè„‘", "e": "computer"},
      {"p": "diÃ nshÃ¬", "c": "ç”µè§†", "e": "TV"},
      {"p": "diÃ nyÇng", "c": "ç”µå½±", "e": "movie"},
      {"p": "bÄo", "c": "åŒ…", "e": "bag"},
      {"p": "yÄ«fu", "c": "è¡£æœ", "e": "clothes"},
      {"p": "qiÃ¡nbÄo", "c": "é’±åŒ…", "e": "wallet"},
      {"p": "yÃ oshi", "c": "é’¥åŒ™", "e": "key"},
      {"p": "bÇ", "c": "ç¬”", "e": "pen"},
      {"p": "zhÇ", "c": "çº¸", "e": "paper"},
      {"p": "zhuÅzi", "c": "æ¡Œå­", "e": "table"},
      {"p": "yÇzi", "c": "æ¤…å­", "e": "chair"},
      {"p": "mÃ©n", "c": "é—¨", "e": "door"},
      {"p": "chuÄng", "c": "çª—", "e": "window"},
      {"p": "dÄ“ng", "c": "ç¯", "e": "light / lamp"},
      {"p": "bÄ“izi", "c": "æ¯å­", "e": "cup / glass"},
      {"p": "pÃ¡nzi", "c": "ç›˜å­", "e": "plate"},
      {"p": "wÇn", "c": "ç¢—", "e": "bowl"},
      {"p": "kuÃ izi", "c": "ç­·å­", "e": "chopsticks"},
      {"p": "dÄo", "c": "åˆ€", "e": "knife"},
      {"p": "shÃ¡ozi", "c": "å‹ºå­", "e": "spoon"},
      {"p": "chÄzi", "c": "å‰å­", "e": "fork"},
      {"p": "qiÃ¡n", "c": "é’±", "e": "money"},
      {"p": "lÇwÃ¹", "c": "ç¤¼ç‰©", "e": "gift"},
      {"p": "zhÃ opiÃ n", "c": "ç…§ç‰‡", "e": "photo"}
    ],
    "Connectors & Conjunctions": [
      {"p": "hÃ©", "c": "å’Œ", "e": "and / with"},
      {"p": "yÄ«nwÃ¨i...suÇ’yÇ...", "c": "å› ä¸º...æ‰€ä»¥...", "e": "because...therefore..."},
      {"p": "suÄ«rÃ¡n...dÃ nshÃ¬...", "c": "è™½ç„¶...ä½†æ˜¯...", "e": "although...but..."},
      {"p": "rÃºguÇ’", "c": "å¦‚æœ", "e": "if"},
      {"p": "huÃ²zhÄ›", "c": "æˆ–è€…", "e": "or"},
      {"p": "dÃ nshÃ¬", "c": "ä½†æ˜¯", "e": "but / however"},
      {"p": "suÇ’yÇ", "c": "æ‰€ä»¥", "e": "so / therefore"}
    ],
    "Animals": [
      {"p": "dÃ²ngwÃ¹", "c": "åŠ¨ç‰©", "e": "animal"},
      {"p": "gÇ’u", "c": "ç‹—", "e": "dog"},
      {"p": "mÄo", "c": "çŒ«", "e": "cat"},
      {"p": "niÇo", "c": "é¸Ÿ", "e": "bird"},
      {"p": "niÃº", "c": "ç‰›", "e": "cow / ox"},
      {"p": "zhÅ«", "c": "çŒª", "e": "pig"},
      {"p": "yÃ¡ng", "c": "ç¾Š", "e": "sheep / goat"},
      {"p": "mÇ", "c": "é©¬", "e": "horse"},
      {"p": "lÃ³ng", "c": "é¾™", "e": "dragon"}
    ]
  },
  "4": {
    "Question Expressions": [
      {"p": "shÃ©nme shÃ­hou", "c": "ä»€ä¹ˆæ—¶å€™", "e": "when (general)"},
      {"p": "zÄ›nme yÃ ng", "c": "æ€ä¹ˆæ ·", "e": "how is...?"},
      {"p": "nÇ guÃ³ rÃ©n", "c": "å“ªå›½äºº", "e": "what nationality?"},
      {"p": "duÅ chÃ¡ng shÃ­jiÄn", "c": "å¤šé•¿æ—¶é—´", "e": "how long (duration)?"},
      {"p": "duÅ dÃ ", "c": "å¤šå¤§", "e": "how old? / how big?"}
    ],
    "Dates & Calendar": [
      {"p": "niÃ¡n", "c": "å¹´", "e": "year"},
      {"p": "yuÃ¨", "c": "æœˆ", "e": "month"},
      {"p": "rÃ¬", "c": "æ—¥", "e": "day (formal)"},
      {"p": "hÃ o", "c": "å·", "e": "day (colloquial)"},
      {"p": "shÄ“ngrÃ¬", "c": "ç”Ÿæ—¥", "e": "birthday"},
      {"p": "suÃ¬", "c": "å²", "e": "years old"},
      {"p": "shÃ ng ge xÄ«ngqÄ«", "c": "ä¸Šä¸ªæ˜ŸæœŸ", "e": "last week"},
      {"p": "zhÃ¨ ge xÄ«ngqÄ«", "c": "è¿™ä¸ªæ˜ŸæœŸ", "e": "this week"},
      {"p": "xiÃ  ge xÄ«ngqÄ«", "c": "ä¸‹ä¸ªæ˜ŸæœŸ", "e": "next week"},
      {"p": "mÄ›i tiÄn", "c": "æ¯å¤©", "e": "every day"},
      {"p": "mÄ›i niÃ¡n", "c": "æ¯å¹´", "e": "every year"}
    ],
    "Grandparents (Paternal vs Maternal)": [
      {"p": "yÃ©ye", "c": "çˆ·çˆ·", "e": "grandpa (paternal)"},
      {"p": "nÇinai", "c": "å¥¶å¥¶", "e": "grandma (paternal)"},
      {"p": "wÃ igÅng", "c": "å¤–å…¬", "e": "grandpa (maternal)"},
      {"p": "wÃ ipÃ³", "c": "å¤–å©†", "e": "grandma (maternal)"}
    ],
    "Honorific Titles": [
      {"p": "[Surname] xiÄnsheng", "c": "å…ˆç”Ÿ", "e": "Mr. [Surname]"},
      {"p": "[Surname] xiÇojiÄ›", "c": "å°å§", "e": "Ms./Miss [Surname]"},
      {"p": "[Surname] tÃ itai", "c": "å¤ªå¤ª", "e": "Mrs. [Surname]"},
      {"p": "[Surname] yÄ«shÄ“ng", "c": "åŒ»ç”Ÿ", "e": "Doctor [Surname]"},
      {"p": "[Surname] lÇoshÄ«", "c": "è€å¸ˆ", "e": "Teacher [Surname]"}
    ],
    "Countries & Places": [
      {"p": "guÃ³", "c": "å›½", "e": "country"},
      {"p": "zhÅngguÃ³", "c": "ä¸­å›½", "e": "China"},
      {"p": "BÄ›ijÄ«ng", "c": "åŒ—äº¬", "e": "Beijing"},
      {"p": "rÃ¬bÄ›n", "c": "æ—¥æœ¬", "e": "Japan"},
      {"p": "hÃ¡nguÃ³", "c": "éŸ©å›½", "e": "Korea"},
      {"p": "mÄ›iguÃ³", "c": "ç¾å›½", "e": "America"},
      {"p": "yÄ«ngguÃ³", "c": "è‹±å›½", "e": "UK"},
      {"p": "fÇguÃ³", "c": "æ³•å›½", "e": "France"},
      {"p": "dÃ©guÃ³", "c": "å¾·å›½", "e": "Germany"},
      {"p": "Ã odÃ lÃ¬yÃ ", "c": "æ¾³å¤§åˆ©äºš", "e": "Australia"},
      {"p": "jiÄnÃ¡dÃ ", "c": "åŠ æ‹¿å¤§", "e": "Canada"},
      {"p": "yÃ¬ndÃ¹", "c": "å°åº¦", "e": "India"},
      {"p": "xÄ«bÄnyÃ¡", "c": "è¥¿ç­ç‰™", "e": "Spain"},
      {"p": "yÃ¬dÃ lÃ¬", "c": "æ„å¤§åˆ©", "e": "Italy"}
    ],
    "Address Vocabulary": [
      {"p": "dÃ¬zhÇ", "c": "åœ°å€", "e": "address"},
      {"p": "qÅ«", "c": "åŒº", "e": "district"},
      {"p": "lÃ¹", "c": "è·¯", "e": "road"},
      {"p": "lÃ³u", "c": "æ¥¼", "e": "building / floor"},
      {"p": "shÃ¬", "c": "å®¤", "e": "room"},
      {"p": "hÃ o", "c": "å·", "e": "number (address)"}
    ],
    "Home & Appliances": [
      {"p": "shÄfÄ", "c": "æ²™å‘", "e": "sofa"},
      {"p": "chuÃ¡ng", "c": "åºŠ", "e": "bed"},
      {"p": "bÄ«ngxiÄng", "c": "å†°ç®±", "e": "refrigerator"},
      {"p": "xÇyÄ«jÄ«", "c": "æ´—è¡£æœº", "e": "washing machine"},
      {"p": "wÄ“ibÅlÃº", "c": "å¾®æ³¢ç‚‰", "e": "microwave"},
      {"p": "diÃ nshÃ¬jÄ«", "c": "ç”µè§†æœº", "e": "TV set"},
      {"p": "kÅngtiÃ¡o", "c": "ç©ºè°ƒ", "e": "air conditioner"},
      {"p": "jÃ¬ngzi", "c": "é•œå­", "e": "mirror"},
      {"p": "chuÄnghÃ¹", "c": "çª—æˆ·", "e": "window"},
      {"p": "chÃºfÃ¡ng", "c": "å¨æˆ¿", "e": "kitchen"}
    ],
    "Food & Drinks (Extended)": [
      {"p": "hÃ nbÇo", "c": "æ±‰å ¡", "e": "burger"},
      {"p": "rÃ¨gÇ’u", "c": "çƒ­ç‹—", "e": "hot dog"},
      {"p": "sÄnmÃ­ngzhÃ¬", "c": "ä¸‰æ˜æ²»", "e": "sandwich"},
      {"p": "yÃ¬dÃ lÃ¬ miÃ n", "c": "æ„å¤§åˆ©é¢", "e": "pasta"},
      {"p": "jÄ« kuÃ i", "c": "é¸¡å—", "e": "chicken nuggets"},
      {"p": "kÄ›lÃ¨", "c": "å¯ä¹", "e": "cola"},
      {"p": "chÃ©ng zhÄ«", "c": "æ©™æ±", "e": "orange juice"},
      {"p": "pÃ­ jiÇ”", "c": "å•¤é…’", "e": "beer"},
      {"p": "qÃ¬ shuÇ", "c": "æ±½æ°´", "e": "soda / sparkling water"},
      {"p": "bÃ ifÃ n", "c": "ç™½é¥­", "e": "plain rice"},
      {"p": "tÄng", "c": "æ±¤", "e": "soup"},
      {"p": "jiÇozi", "c": "é¥ºå­", "e": "dumplings"},
      {"p": "bÄozi", "c": "åŒ…å­", "e": "steamed buns"}
    ],
    "Body Parts": [
      {"p": "tÃ³u", "c": "å¤´", "e": "head"},
      {"p": "tÃ³ufa", "c": "å¤´å‘", "e": "hair"},
      {"p": "liÇn", "c": "è„¸", "e": "face"},
      {"p": "bÃ­zi", "c": "é¼»å­", "e": "nose"},
      {"p": "Ä›rduo", "c": "è€³æœµ", "e": "ear"},
      {"p": "zuÇba", "c": "å˜´å·´", "e": "mouth"},
      {"p": "yÃ¡chÇ", "c": "ç‰™é½¿", "e": "teeth"},
      {"p": "shÇ’u", "c": "æ‰‹", "e": "hand"},
      {"p": "jiÇo", "c": "è„š", "e": "foot"},
      {"p": "yÇnjing", "c": "çœ¼ç›", "e": "eye"},
      {"p": "tuÇ", "c": "è…¿", "e": "leg"},
      {"p": "dÃ¹zi", "c": "è‚šå­", "e": "stomach / belly"}
    ],
    "Measure Words": [
      {"p": "gÃ¨", "c": "ä¸ª", "e": "general measure word"},
      {"p": "bÄ›n", "c": "æœ¬", "e": "for books"},
      {"p": "zhÄng", "c": "å¼ ", "e": "for flat objects"},
      {"p": "jiÃ n", "c": "ä»¶", "e": "for clothes, matters"},
      {"p": "zhÄ«", "c": "åª", "e": "for animals"},
      {"p": "tiÃ¡o", "c": "æ¡", "e": "for long objects"},
      {"p": "bÄ“i", "c": "æ¯", "e": "cup of"},
      {"p": "pÃ­ng", "c": "ç“¶", "e": "bottle of"},
      {"p": "wÃ¨i", "c": "ä½", "e": "for people (polite)"},
      {"p": "kuÃ i", "c": "å—", "e": "piece / dollar"}
    ],
    "Useful Expressions": [
      {"p": "zhÃ¨ngzÃ i", "c": "æ­£åœ¨", "e": "in the process of"},
      {"p": "yÄ«xiÃ ", "c": "ä¸€ä¸‹", "e": "a little / give it a try"},
      {"p": "yÄ«qÇ", "c": "ä¸€èµ·", "e": "together"},
      {"p": "yÄ«diÇnr", "c": "ä¸€ç‚¹å„¿", "e": "a little bit"},
      {"p": "hÃ nyu", "c": "æ±‰è¯­", "e": "Chinese language"},
      {"p": "zhÅngwÃ©n", "c": "ä¸­æ–‡", "e": "Chinese (written)"},
      {"p": "ZhÅngguÃ³ rÃ©n", "c": "ä¸­å›½äºº", "e": "Chinese person"},
      {"p": "xÃ¬ng", "c": "å§“", "e": "surname"},
      {"p": "jiÃ o", "c": "å«", "e": "to be called"}
    ]
  }
};

// ============ SENTENCE DATA ============
// Each sentence has: pinyin, chinese, english, blank position, answer, and wrong options
const SENTENCE_DATA = {
  "1": [
    // Using adjectives and degree adverbs
    {"p": "WÇ’ ___ Ã¨ le.", "c": "æˆ‘ ___ é¥¿äº†ã€‚", "e": "I am very hungry.", "answer": "hÄ›n", "answerC": "å¾ˆ", "wrongs": ["yÄ›", "dÅu", "bÃ¹"]},
    {"p": "TÄ ___ mÃ¡ng.", "c": "ä»– ___ å¿™ã€‚", "e": "He is also busy.", "answer": "yÄ›", "answerC": "ä¹Ÿ", "wrongs": ["hÄ›n", "bÃ¹", "zuÃ¬"]},
    {"p": "JÄ«ntiÄn tiÄnqÃ¬ hÄ›n ___.", "c": "ä»Šå¤©å¤©æ°”å¾ˆ ___ã€‚", "e": "Today's weather is very hot.", "answer": "rÃ¨", "answerC": "çƒ­", "wrongs": ["lÄ›ng", "hÇo", "mÃ¡ng"]},
    {"p": "ZhÃ¨ge ___ guÃ¬.", "c": "è¿™ä¸ª ___ è´µã€‚", "e": "This is too expensive.", "answer": "tÃ i", "answerC": "å¤ª", "wrongs": ["hÄ›n", "yÄ›", "bÃ¹"]},
    {"p": "WÇ’ ___ chÄ« mÇfÃ n.", "c": "æˆ‘ ___ åƒç±³é¥­ã€‚", "e": "I want to eat rice.", "answer": "yÃ o", "answerC": "è¦", "wrongs": ["qÃ¹", "lÃ¡i", "kÃ n"]},
    {"p": "NÇ ___ shÃ©nme?", "c": "ä½  ___ ä»€ä¹ˆï¼Ÿ", "e": "What do you want to eat?", "answer": "chÄ«", "answerC": "åƒ", "wrongs": ["hÄ“", "qÃ¹", "kÃ n"]},
    {"p": "TÄ shÃ¬ ___ gÄ“ge.", "c": "ä»–æ˜¯ ___ å“¥å“¥ã€‚", "e": "He is my older brother.", "answer": "wÇ’ de", "answerC": "æˆ‘çš„", "wrongs": ["nÇ de", "tÄ de", "wÇ’men"]},
    {"p": "WÇ’ ___ xÇhuan kÄfÄ“i.", "c": "æˆ‘ ___ å–œæ¬¢å’–å•¡ã€‚", "e": "I don't like coffee.", "answer": "bÃ¹", "answerC": "ä¸", "wrongs": ["hÄ›n", "yÄ›", "dÅu"]},
    {"p": "ZhÃ¨ge pÃ­ngguÇ’ hÄ›n ___.", "c": "è¿™ä¸ªè‹¹æœå¾ˆ ___ã€‚", "e": "This apple is very delicious.", "answer": "hÇochÄ«", "answerC": "å¥½åƒ", "wrongs": ["hÇo", "dÃ ", "guÃ¬"]},
    {"p": "___ shÃ¬ shÃ©i?", "c": "___ æ˜¯è°ï¼Ÿ", "e": "Who is that?", "answer": "NÃ ", "answerC": "é‚£", "wrongs": ["ZhÃ¨", "ShÃ©nme", "NÇ"]},
    {"p": "WÇ’ jiÄ yÇ’u ___ ge rÃ©n.", "c": "æˆ‘å®¶æœ‰ ___ ä¸ªäººã€‚", "e": "My family has five people.", "answer": "wÇ”", "answerC": "äº”", "wrongs": ["sÄn", "liÃ¹", "sÃ¬"]},
    {"p": "MÄma zuÃ² de cÃ i ___ hÇochÄ«.", "c": "å¦ˆå¦ˆåšçš„èœ ___ å¥½åƒã€‚", "e": "Mom's cooking is the most delicious.", "answer": "zuÃ¬", "answerC": "æœ€", "wrongs": ["hÄ›n", "yÄ›", "bÃ¹"]}
  ],
  "2": [
    // Time, places, modals
    {"p": "XiÃ nzÃ i ___ diÇn?", "c": "ç°åœ¨ ___ ç‚¹ï¼Ÿ", "e": "What time is it now?", "answer": "jÇ", "answerC": "å‡ ", "wrongs": ["shÃ©nme", "nÇ", "duÅshao"]},
    {"p": "WÇ’ ___ shuÅ ZhÅngwÃ©n.", "c": "æˆ‘ ___ è¯´ä¸­æ–‡ã€‚", "e": "I can speak Chinese.", "answer": "huÃ¬", "answerC": "ä¼š", "wrongs": ["yÃ o", "qÃ¹", "xiÇng"]},
    {"p": "NÇ ___ qÃ¹ cÃ¨suÇ’ ma?", "c": "ä½  ___ å»å•æ‰€å—ï¼Ÿ", "e": "May I go to the bathroom?", "answer": "kÄ›yÇ", "answerC": "å¯ä»¥", "wrongs": ["huÃ¬", "yÃ o", "nÃ©ng"]},
    {"p": "MÃ­ngtiÄn wÇ’ ___ qÃ¹ xuÃ©xiÃ o.", "c": "æ˜å¤©æˆ‘ ___ å»å­¦æ ¡ã€‚", "e": "Tomorrow I will go to school.", "answer": "yÃ o", "answerC": "è¦", "wrongs": ["huÃ¬", "kÄ›yÇ", "nÃ©ng"]},
    {"p": "WÇ’ xiÇng hÄ“ yÃ¬ ___ kÄfÄ“i.", "c": "æˆ‘æƒ³å–ä¸€ ___ å’–å•¡ã€‚", "e": "I want to drink a cup of coffee.", "answer": "bÄ“i", "answerC": "æ¯", "wrongs": ["gÃ¨", "pÃ­ng", "zhÄ«"]},
    {"p": "HuÇ’chÄ“zhÃ n zÃ i ___?", "c": "ç«è½¦ç«™åœ¨ ___ï¼Ÿ", "e": "Where is the train station?", "answer": "nÇlÇ", "answerC": "å“ªé‡Œ", "wrongs": ["zhÃ¨lÇ", "nÃ lÇ", "shÃ©nme"]},
    {"p": "JÄ«ntiÄn ___ xiÃ  yÇ”.", "c": "ä»Šå¤© ___ ä¸‹é›¨ã€‚", "e": "It might rain today.", "answer": "kÄ›nÃ©ng", "answerC": "å¯èƒ½", "wrongs": ["yÄ«nggÄi", "bÃ¬xÅ«", "huÃ¬"]},
    {"p": "QÇng ___, xÇshÇ’ujiÄn zÃ i nÇlÇ?", "c": "è¯· ___ï¼Œæ´—æ‰‹é—´åœ¨å“ªé‡Œï¼Ÿ", "e": "Excuse me, where is the restroom?", "answer": "wÃ¨n", "answerC": "é—®", "wrongs": ["zuÃ²", "jÃ¬n", "shuÅ"]},
    {"p": "WÇ’ ___ chÅ«zÅ«chÄ“ qÃ¹ jÄ«chÇng.", "c": "æˆ‘ ___ å‡ºç§Ÿè½¦å»æœºåœºã€‚", "e": "I take a taxi to the airport.", "answer": "zuÃ²", "answerC": "å", "wrongs": ["qÃ¹", "lÃ¡i", "kÄi"]},
    {"p": "TiÄnqÃ¬ ___ le.", "c": "å¤©æ°” ___ äº†ã€‚", "e": "The weather has gotten cold.", "answer": "lÄ›ng", "answerC": "å†·", "wrongs": ["rÃ¨", "hÇo", "nuÇnhuo"]},
    {"p": "WÇ’ mÄ›itiÄn zÇoshang ___ diÇn qÇchuÃ¡ng.", "c": "æˆ‘æ¯å¤©æ—©ä¸Š ___ ç‚¹èµ·åºŠã€‚", "e": "I wake up at 7 o'clock every morning.", "answer": "qÄ«", "answerC": "ä¸ƒ", "wrongs": ["liÃ¹", "bÄ", "jiÇ”"]},
    {"p": "ZhÃ¨ jiÃ n yÄ«fu duÅshao ___?", "c": "è¿™ä»¶è¡£æœå¤šå°‘ ___ï¼Ÿ", "e": "How much is this piece of clothing?", "answer": "qiÃ¡n", "answerC": "é’±", "wrongs": ["gÃ¨", "jiÃ n", "kuÃ i"]}
  ],
  "3": [
    // Extended expressions, conjunctions, actions
    {"p": "WÇ’ ___ rÃ¨nshi tÄ.", "c": "æˆ‘ ___ è®¤è¯†ä»–ã€‚", "e": "I already know him.", "answer": "yÇjÄ«ng", "answerC": "å·²ç»", "wrongs": ["hÃ¡i", "cÃ¡i", "jiÃ¹"]},
    {"p": "___ tiÄnqÃ¬ bÃ¹ hÇo, wÇ’ hÃ¡i yÃ o qÃ¹.", "c": "___ å¤©æ°”ä¸å¥½ï¼Œæˆ‘è¿˜è¦å»ã€‚", "e": "Although the weather is bad, I still want to go.", "answer": "SuÄ«rÃ¡n", "answerC": "è™½ç„¶", "wrongs": ["YÄ«nwÃ¨i", "RÃºguÇ’", "DÃ nshÃ¬"]},
    {"p": "WÇ’ yÇ’u mÄo ___ yÇ’u gÇ’u.", "c": "æˆ‘æœ‰çŒ« ___ æœ‰ç‹—ã€‚", "e": "I have both cats and dogs.", "answer": "yÄ›", "answerC": "ä¹Ÿ", "wrongs": ["hÃ©", "dÅu", "hÃ¡i"]},
    {"p": "QÇng nÇ ___ yÃ­xiÃ .", "c": "è¯·ä½  ___ ä¸€ä¸‹ã€‚", "e": "Please wait a moment.", "answer": "dÄ›ng", "answerC": "ç­‰", "wrongs": ["kÃ n", "shuÅ", "zuÃ²"]},
    {"p": "WÇ’men ___ qÃ¹ kÃ n diÃ nyÇng ba.", "c": "æˆ‘ä»¬ ___ å»çœ‹ç”µå½±å§ã€‚", "e": "Let's go watch a movie together.", "answer": "yÄ«qÇ", "answerC": "ä¸€èµ·", "wrongs": ["yÄ«xiÃ ", "yÄ«diÇn", "yÄ«huÃ¬r"]},
    {"p": "TÄ shÃ¬ wÇ’ de ___.", "c": "ä»–æ˜¯æˆ‘çš„ ___ã€‚", "e": "He is my classmate.", "answer": "tÃ³ngxuÃ©", "answerC": "åŒå­¦", "wrongs": ["tÃ³ngshÃ¬", "pÃ©ngyou", "lÇoshÄ«"]},
    {"p": "WÇ’ xÇhuan tÄ«ng yÄ«nyuÃ¨ ___ kÃ n shÅ«.", "c": "æˆ‘å–œæ¬¢å¬éŸ³ä¹ ___ çœ‹ä¹¦ã€‚", "e": "I like both listening to music and reading.", "answer": "hÃ©", "answerC": "å’Œ", "wrongs": ["yÄ›", "dÅu", "huÃ²zhÄ›"]},
    {"p": "___ xiÃ  yÇ”, wÇ’ jiÃ¹ bÃº qÃ¹ le.", "c": "___ ä¸‹é›¨ï¼Œæˆ‘å°±ä¸å»äº†ã€‚", "e": "If it rains, I won't go.", "answer": "RÃºguÇ’", "answerC": "å¦‚æœ", "wrongs": ["SuÄ«rÃ¡n", "YÄ«nwÃ¨i", "DÃ nshÃ¬"]},
    {"p": "ZhÃ¨ge zhÅumÃ² nÇ yÇ’u ___ ma?", "c": "è¿™ä¸ªå‘¨æœ«ä½ æœ‰ ___ å—ï¼Ÿ", "e": "Do you have time this weekend?", "answer": "shÃ­jiÄn", "answerC": "æ—¶é—´", "wrongs": ["kÃ²ng", "shÃ¬", "mÃ¡ng"]},
    {"p": "WÇ’ de shÇ’ujÄ« ___ le.", "c": "æˆ‘çš„æ‰‹æœº ___ äº†ã€‚", "e": "My phone is broken.", "answer": "huÃ i", "answerC": "å", "wrongs": ["hÇo", "xÄ«n", "guÃ¬"]},
    {"p": "NÇ ___ guÃ² ZhÅngguÃ³ ma?", "c": "ä½  ___ è¿‡ä¸­å›½å—ï¼Ÿ", "e": "Have you been to China?", "answer": "qÃ¹", "answerC": "å»", "wrongs": ["lÃ¡i", "dÃ o", "zÃ i"]},
    {"p": "TÄ mÄ›i tiÄn zÇ’u ___ qÃ¹ shÃ ngbÄn.", "c": "ä»–æ¯å¤©èµ° ___ å»ä¸Šç­ã€‚", "e": "He walks to work every day.", "answer": "lÃ¹", "answerC": "è·¯", "wrongs": ["bÃ¹", "chÄ“", "jiÄ"]}
  ],
  "4": [
    // Advanced expressions, measure words, cultural
    {"p": "NÇ shÃ¬ ___ guÃ³ rÃ©n?", "c": "ä½ æ˜¯ ___ å›½äººï¼Ÿ", "e": "What nationality are you?", "answer": "nÇ", "answerC": "å“ª", "wrongs": ["shÃ©nme", "nÇlÇ", "jÇ"]},
    {"p": "WÇ’ de shÄ“ngrÃ¬ shÃ¬ sÄn yuÃ¨ shÃ­wÇ” ___.", "c": "æˆ‘çš„ç”Ÿæ—¥æ˜¯ä¸‰æœˆåäº” ___ã€‚", "e": "My birthday is March 15th.", "answer": "hÃ o", "answerC": "å·", "wrongs": ["rÃ¬", "tiÄn", "niÃ¡n"]},
    {"p": "WÇ’ yÃ o mÇi liÇng ___ shÅ«.", "c": "æˆ‘è¦ä¹°ä¸¤ ___ ä¹¦ã€‚", "e": "I want to buy two books.", "answer": "bÄ›n", "answerC": "æœ¬", "wrongs": ["gÃ¨", "zhÄng", "jiÃ n"]},
    {"p": "ZhÃ¨ ___ gÇ’u hÄ›n kÄ›'Ã i.", "c": "è¿™ ___ ç‹—å¾ˆå¯çˆ±ã€‚", "e": "This dog is very cute.", "answer": "zhÄ«", "answerC": "åª", "wrongs": ["gÃ¨", "tiÃ¡o", "bÄ›n"]},
    {"p": "WÇ’ ___ ZhÄng.", "c": "æˆ‘ ___ å¼ ã€‚", "e": "My surname is Zhang.", "answer": "xÃ¬ng", "answerC": "å§“", "wrongs": ["mÃ­ng", "jiÃ o", "shÃ¬"]},
    {"p": "NÇ ___ duÅ dÃ ?", "c": "ä½  ___ å¤šå¤§ï¼Ÿ", "e": "How old are you this year?", "answer": "jÄ«nniÃ¡n", "answerC": "ä»Šå¹´", "wrongs": ["mÃ­ngtiÄn", "zuÃ³tiÄn", "xiÃ nzÃ i"]},
    {"p": "WÇ’ yÃ©ye jÄ«nniÃ¡n bÄshÃ­ ___ le.", "c": "æˆ‘çˆ·çˆ·ä»Šå¹´å…«å ___ äº†ã€‚", "e": "My grandfather is eighty years old this year.", "answer": "suÃ¬", "answerC": "å²", "wrongs": ["niÃ¡n", "hÃ o", "tiÄn"]},
    {"p": "QÇng gÄ›i wÇ’ yÃ¬ ___ shuÇ.", "c": "è¯·ç»™æˆ‘ä¸€ ___ æ°´ã€‚", "e": "Please give me a bottle of water.", "answer": "pÃ­ng", "answerC": "ç“¶", "wrongs": ["bÄ“i", "gÃ¨", "zhÄ«"]},
    {"p": "WÇ’ ___ xuÃ© ZhÅngwÃ©n.", "c": "æˆ‘ ___ å­¦ä¸­æ–‡ã€‚", "e": "I am currently studying Chinese.", "answer": "zhÃ¨ngzÃ i", "answerC": "æ­£åœ¨", "wrongs": ["yÇjÄ«ng", "hÃ¡i", "jiÃ¹"]},
    {"p": "WÇ’ jiÄ zÃ i sÄn ___.", "c": "æˆ‘å®¶åœ¨ä¸‰ ___ã€‚", "e": "My home is on the third floor.", "answer": "lÃ³u", "answerC": "æ¥¼", "wrongs": ["lÃ¹", "shÃ¬", "hÃ o"]},
    {"p": "ZhÃ¨ wÃ¨i shÃ¬ WÃ¡ng ___.", "c": "è¿™ä½æ˜¯ç‹ ___ã€‚", "e": "This is Mr. Wang.", "answer": "xiÄnsheng", "answerC": "å…ˆç”Ÿ", "wrongs": ["xiÇojiÄ›", "tÃ itai", "lÇoshÄ«"]},
    {"p": "WÇ’ xiÇng ___ yÃ­xiÃ .", "c": "æˆ‘æƒ³ ___ ä¸€ä¸‹ã€‚", "e": "I want to give it a try.", "answer": "shÃ¬", "answerC": "è¯•", "wrongs": ["kÃ n", "zuÃ²", "shuÅ"]}
  ]
};

// ============ STATE MANAGEMENT ============
const $ = id => document.getElementById(id);

// Load saved progress from localStorage
let progress = JSON.parse(localStorage.getItem('chineseQuizProgress')) || {
  mastered: {},           // word_id -> true (mastered)
  masteredSentences: {},  // sentence_id -> true (mastered)
  reviewWords: [],        // [{p, c, e, category, level, streak}]
  reviewSentences: [],    // [{...sentence, level, streak, showHint}]
  stats: {
    totalCorrect: 0,
    totalWrong: 0
  },
  categoryStats: {}       // category -> {correct, wrong, attempts}
};

// Migrate old progress data if needed
if (!progress.masteredSentences) progress.masteredSentences = {};
if (!progress.reviewSentences) progress.reviewSentences = [];

let session = null;
let currentWordIndex = 0;
let answered = false;

// ============ AUDIO ============
function speak(text) {
  if ('speechSynthesis' in window) {
    window.speechSynthesis.cancel();
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'zh-CN';
    utterance.rate = 0.8;
    
    const audioBtn = $('audio-btn');
    audioBtn.classList.add('playing');
    utterance.onend = () => audioBtn.classList.remove('playing');
    utterance.onerror = () => audioBtn.classList.remove('playing');
    
    window.speechSynthesis.speak(utterance);
  }
}

// ============ UTILITY FUNCTIONS ============
function shuffle(array) {
  const arr = [...array];
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function getWordId(word) {
  return `${word.c}_${word.p}`;
}

function getAllWordsInCategory(level, category) {
  return VOCAB_DATA[level]?.[category] || [];
}

function getAllWordsInLevel(level) {
  const words = [];
  const categories = VOCAB_DATA[level] || {};
  for (const [cat, catWords] of Object.entries(categories)) {
    catWords.forEach(w => words.push({...w, category: cat, level}));
  }
  return words;
}

function getWrongAnswers(correctWord, allWords, count = 2) {
  const others = allWords.filter(w => w.e !== correctWord.e);
  return shuffle(others).slice(0, count).map(w => w.e);
}

// ============ PROGRESS & STATS ============
function saveProgress() {
  localStorage.setItem('chineseQuizProgress', JSON.stringify(progress));
}

function updateGlobalStats() {
  const totalMastered = Object.keys(progress.mastered).length;
  const totalAttempts = progress.stats.totalCorrect + progress.stats.totalWrong;
  const accuracy = totalAttempts > 0 
    ? Math.round((progress.stats.totalCorrect / totalAttempts) * 100) 
    : 0;
  
  $('total-mastered').textContent = totalMastered;
  $('total-accuracy').textContent = `${accuracy}%`;
  $('total-attempts').textContent = totalAttempts;
}

function getCategoryProgress(level, category) {
  const words = getAllWordsInCategory(level, category);
  const mastered = words.filter(w => progress.mastered[getWordId(w)]).length;
  return { mastered, total: words.length, percent: words.length ? Math.round((mastered / words.length) * 100) : 0 };
}

function getLevelProgress(level) {
  const words = getAllWordsInLevel(level);
  const mastered = words.filter(w => progress.mastered[getWordId(w)]).length;
  const catStats = {};
  for (const cat of Object.keys(VOCAB_DATA[level] || {})) {
    const key = `${level}_${cat}`;
    catStats[cat] = progress.categoryStats[key] || { correct: 0, wrong: 0 };
  }
  const totalCorrect = Object.values(catStats).reduce((a, b) => a + b.correct, 0);
  const totalWrong = Object.values(catStats).reduce((a, b) => a + b.wrong, 0);
  const totalAttempts = totalCorrect + totalWrong;
  const accuracy = totalAttempts > 0 ? Math.round((totalCorrect / totalAttempts) * 100) : 0;
  
  return { mastered, total: words.length, percent: words.length ? Math.round((mastered / words.length) * 100) : 0, accuracy };
}

// ============ SENTENCE HELPERS ============
function getSentenceId(sentence) {
  return `sent_${sentence.c}_${sentence.answer}`;
}

function getSentenceProgress(level) {
  const sentences = SENTENCE_DATA[level] || [];
  const mastered = sentences.filter(s => progress.masteredSentences[getSentenceId(s)]).length;
  return { mastered, total: sentences.length, percent: sentences.length ? Math.round((mastered / sentences.length) * 100) : 0 };
}

function addSentenceToReview(sentence, level) {
  const id = getSentenceId(sentence);
  const existing = progress.reviewSentences.find(s => getSentenceId(s) === id);
  if (!existing) {
    progress.reviewSentences.push({
      ...sentence,
      level,
      streak: 0,
      showHint: true // Will show English hint on review
    });
  } else {
    existing.streak = 0;
    existing.showHint = true;
  }
  saveProgress();
}

function updateReviewSentence(sentence, correct) {
  const id = getSentenceId(sentence);
  const idx = progress.reviewSentences.findIndex(s => getSentenceId(s) === id);
  if (idx !== -1) {
    if (correct) {
      progress.reviewSentences[idx].streak++;
      if (progress.reviewSentences[idx].streak >= 3) {
        progress.reviewSentences.splice(idx, 1);
        progress.masteredSentences[id] = true;
      }
    } else {
      progress.reviewSentences[idx].streak = 0;
    }
    saveProgress();
  }
}

function clearSentenceReview() {
  if (confirm('Clear all sentences from review? This cannot be undone.')) {
    progress.reviewSentences = [];
    saveProgress();
    renderMenu();
  }
}

// ============ REVIEW SYSTEM ============
function addToReview(word, level, category) {
  const existing = progress.reviewWords.find(w => getWordId(w) === getWordId(word));
  if (!existing) {
    progress.reviewWords.push({
      ...word,
      level,
      category,
      streak: 0
    });
  } else {
    existing.streak = 0; // Reset streak if wrong again
  }
  saveProgress();
}

function updateReviewWord(word, correct) {
  const idx = progress.reviewWords.findIndex(w => getWordId(w) === getWordId(word));
  if (idx !== -1) {
    if (correct) {
      progress.reviewWords[idx].streak++;
      // Graduate after 3 correct in a row
      if (progress.reviewWords[idx].streak >= 3) {
        progress.reviewWords.splice(idx, 1);
        progress.mastered[getWordId(word)] = true;
      }
    } else {
      progress.reviewWords[idx].streak = 0;
    }
    saveProgress();
  }
}

// ============ MENU RENDERING ============
function renderMenu() {
  const sections = $('menu-sections');
  sections.innerHTML = '';
  
  // Review Section
  const reviewCount = progress.reviewWords.length;
  const sentenceReviewCount = progress.reviewSentences.length;
  const reviewSection = document.createElement('div');
  reviewSection.className = 'menu-section review-section';
  reviewSection.innerHTML = `
    <h2>Review</h2>
    <div class="category-grid expanded">
      <div class="category-card review-card ${reviewCount === 0 ? 'empty' : ''}" id="review-card-btn">
        <div class="category-name">Words to Review</div>
        <div class="category-count">${reviewCount} word${reviewCount !== 1 ? 's' : ''} ${reviewCount > 0 ? 'â€” click to practice' : ''}</div>
      </div>
      <div class="category-card review-card sentence-review ${sentenceReviewCount === 0 ? 'empty' : ''}" id="sentence-review-card-btn">
        <div class="category-name">Sentences to Review</div>
        <div class="category-count">${sentenceReviewCount} sentence${sentenceReviewCount !== 1 ? 's' : ''} ${sentenceReviewCount > 0 ? 'â€” click to practice' : ''}</div>
      </div>
    </div>
    <div class="review-buttons">
      ${reviewCount > 0 ? '<button type="button" class="clear-btn" id="clear-review-btn">Clear Words</button>' : ''}
      ${sentenceReviewCount > 0 ? '<button type="button" class="clear-btn" id="clear-sentence-review-btn">Clear Sentences</button>' : ''}
    </div>
  `;
  sections.appendChild(reviewSection);
  
  // Add review button listeners
  if (reviewCount > 0) {
    document.getElementById('review-card-btn').addEventListener('click', startReview);
    document.getElementById('clear-review-btn').addEventListener('click', clearReview);
  }
  if (sentenceReviewCount > 0) {
    document.getElementById('sentence-review-card-btn').addEventListener('click', startSentenceReview);
    document.getElementById('clear-sentence-review-btn').addEventListener('click', clearSentenceReview);
  }
  
  // Level Sections
  for (let level = 1; level <= 4; level++) {
    const categories = Object.keys(VOCAB_DATA[level] || {});
    const levelProg = getLevelProgress(level);
    const sentenceProg = getSentenceProgress(level);
    
    const levelSection = document.createElement('div');
    levelSection.className = 'menu-section';
    levelSection.innerHTML = `
      <div class="level-header" data-level="${level}">
        <div class="level-title">Level ${level}</div>
        <div class="level-meta">
          <span class="level-progress">${levelProg.mastered}/${levelProg.total} mastered</span>
          ${levelProg.accuracy > 0 ? `<span class="level-accuracy">${levelProg.accuracy}% accuracy</span>` : ''}
          <button type="button" class="play-all-btn" data-level="${level}">Play All</button>
          <span class="expand-icon">â–¼</span>
        </div>
      </div>
      <div class="category-grid" id="level-${level}-grid">
        ${categories.map((cat, idx) => {
          const catProg = getCategoryProgress(level, cat);
          const isMastered = catProg.percent === 100;
          return `
            <div class="category-card ${isMastered ? 'mastered' : ''}" data-level="${level}" data-category="${idx}">
              <div class="category-name">${cat}</div>
              <div class="category-count">${catProg.mastered}/${catProg.total} words</div>
              <div class="category-progress">
                <div class="category-progress-fill" style="width: ${catProg.percent}%"></div>
              </div>
            </div>
          `;
        }).join('')}
        <div class="category-card sentence-card ${sentenceProg.percent === 100 ? 'mastered' : ''}" data-level="${level}" data-sentence="true">
          <div class="category-name">Practice Sentences</div>
          <div class="category-count">${sentenceProg.mastered}/${sentenceProg.total} sentences</div>
          <div class="category-progress">
            <div class="category-progress-fill" style="width: ${sentenceProg.percent}%"></div>
          </div>
        </div>
      </div>
    `;
    sections.appendChild(levelSection);
    
    // Add event listeners for this level
    const levelHeader = levelSection.querySelector('.level-header');
    const playAllBtn = levelSection.querySelector('.play-all-btn');
    const levelNum = level; // Capture in closure
    
    // Play All button
    playAllBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      e.preventDefault();
      startLevel(levelNum);
    });
    
    // Level header - toggle expand/collapse
    levelHeader.addEventListener('click', function(e) {
      // Don't toggle if clicking the Play All button
      if (e.target.classList.contains('play-all-btn')) {
        return;
      }
      toggleLevel(levelNum);
    });
    
    // Add click listeners for category cards (vocab)
    const levelCategories = categories.slice(); // Copy array for this level
    const categoryCards = levelSection.querySelectorAll('.category-card:not(.sentence-card)');
    for (let i = 0; i < categoryCards.length; i++) {
      const card = categoryCards[i];
      const catName = levelCategories[i];
      card.addEventListener('click', function(e) {
        e.stopPropagation();
        startCategory(levelNum, catName);
      });
    }
    
    // Add click listener for sentence practice card
    const sentenceCard = levelSection.querySelector('.sentence-card');
    sentenceCard.addEventListener('click', function(e) {
      e.stopPropagation();
      startSentencePractice(levelNum);
    });
  }
  
  updateGlobalStats();
}

function toggleLevel(level) {
  const grid = $(`level-${level}-grid`);
  const header = grid.previousElementSibling;
  grid.classList.toggle('expanded');
  header.classList.toggle('expanded');
}

function clearReview() {
  if (confirm('Clear all words from review? This cannot be undone.')) {
    progress.reviewWords = [];
    saveProgress();
    renderMenu();
  }
}

// ============ SETTINGS MODAL ============
function openSettings() {
  updateResetInfo();
  $('settings-modal').classList.add('show');
}

function closeSettings() {
  $('settings-modal').classList.remove('show');
}

function updateResetInfo() {
  for (let level = 1; level <= 4; level++) {
    const words = getAllWordsInLevel(level);
    const sentences = SENTENCE_DATA[level] || [];
    const masteredWords = words.filter(w => progress.mastered[getWordId(w)]).length;
    const masteredSentences = sentences.filter(s => progress.masteredSentences[getSentenceId(s)]).length;
    
    const infoEl = document.getElementById(`reset-info-${level}`);
    if (infoEl) {
      infoEl.textContent = `${masteredWords} words, ${masteredSentences} sentences mastered`;
    }
  }
}

function resetLevel(level) {
  const levelName = `Level ${level}`;
  if (!confirm(`Reset all progress for ${levelName}? This cannot be undone.`)) return;
  
  // Get all words and sentences for this level
  const words = getAllWordsInLevel(level);
  const sentences = SENTENCE_DATA[level] || [];
  
  // Remove mastered status for words in this level
  words.forEach(w => {
    delete progress.mastered[getWordId(w)];
  });
  
  // Remove mastered status for sentences in this level
  sentences.forEach(s => {
    delete progress.masteredSentences[getSentenceId(s)];
  });
  
  // Remove review words from this level
  progress.reviewWords = progress.reviewWords.filter(w => w.level !== level);
  
  // Remove review sentences from this level
  progress.reviewSentences = progress.reviewSentences.filter(s => s.level !== level);
  
  // Reset category stats for this level
  for (const cat of Object.keys(VOCAB_DATA[level] || {})) {
    const key = `${level}_${cat}`;
    delete progress.categoryStats[key];
  }
  
  saveProgress();
  updateResetInfo();
  renderMenu();
}

function resetAll() {
  if (!confirm('Reset ALL progress? This will clear everything and cannot be undone.')) return;
  
  // Clear everything
  progress = {
    mastered: {},
    masteredSentences: {},
    reviewWords: [],
    reviewSentences: [],
    stats: {
      totalCorrect: 0,
      totalWrong: 0
    },
    categoryStats: {}
  };
  
  saveProgress();
  closeSettings();
  renderMenu();
}

// ============ QUIZ SESSION ============
function startCategory(level, category) {
  const words = getAllWordsInCategory(level, category).map(w => ({
    ...w,
    level,
    category
  }));
  
  if (words.length === 0) return;
  
  session = {
    type: 'category',
    level,
    category,
    words: shuffle(words),
    correct: 0,
    wrong: 0,
    wrongWords: []
  };
  
  currentWordIndex = 0;
  showQuizSession();
}

function startLevel(level) {
  const words = getAllWordsInLevel(level);
  
  if (words.length === 0) return;
  
  session = {
    type: 'level',
    level,
    category: `All Level ${level}`,
    words: shuffle(words),
    correct: 0,
    wrong: 0,
    wrongWords: []
  };
  
  currentWordIndex = 0;
  showQuizSession();
}

function startReview() {
  if (progress.reviewWords.length === 0) return;
  
  session = {
    type: 'review',
    level: 'Review',
    category: 'Words to Review',
    words: shuffle([...progress.reviewWords]),
    correct: 0,
    wrong: 0,
    wrongWords: []
  };
  
  currentWordIndex = 0;
  showQuizSession();
}

function startSentencePractice(level) {
  const sentences = SENTENCE_DATA[level] || [];
  if (sentences.length === 0) return;
  
  session = {
    type: 'sentence',
    level,
    category: 'Practice Sentences',
    sentences: shuffle(sentences.map(s => ({...s, level, showHint: false}))),
    correct: 0,
    wrong: 0,
    wrongSentences: []
  };
  
  currentWordIndex = 0;
  showSentenceSession();
}

function startSentenceReview() {
  if (progress.reviewSentences.length === 0) return;
  
  session = {
    type: 'sentence-review',
    level: 'Review',
    category: 'Sentences to Review',
    sentences: shuffle([...progress.reviewSentences]),
    correct: 0,
    wrong: 0,
    wrongSentences: []
  };
  
  currentWordIndex = 0;
  showSentenceSession();
}

function showSentenceSession() {
  $('main-menu').classList.add('hidden');
  $('quiz-session').classList.add('active');
  $('quiz-area').style.display = 'flex';
  $('complete-screen').classList.remove('show');
  
  $('session-title').textContent = session.type === 'sentence-review' ? 'Review' : `Level ${session.level}`;
  $('session-subtitle').textContent = session.category;
  
  renderSentenceQuestion();
}

function renderSentenceQuestion() {
  answered = false;
  const sentence = session.sentences[currentWordIndex];
  const quizCard = document.querySelector('.quiz-card');
  
  // Add sentence-mode class for different styling
  quizCard.classList.add('sentence-mode');
  quizCard.classList.remove('answered');
  
  // Build answer options
  const allAnswers = shuffle([sentence.answer, ...sentence.wrongs]);
  
  // Create styled sentence with underline blanks
  const pinyinWithBlank = sentence.p.replace('___', '<span class="blank-box" id="pinyin-blank"></span>');
  const chineseWithBlank = sentence.c.replace('___', '<span class="blank-box" id="chinese-blank"></span>');
  
  // Update display - pinyin is hero (larger), Chinese is secondary
  $('card-label').textContent = `Level ${sentence.level} â€¢ Sentence`;
  
  // Pinyin - the main focus
  $('pinyin').innerHTML = pinyinWithBlank;
  $('pinyin').style.cssText = ''; // Reset inline styles
  
  // Chinese - smaller, supporting role
  $('chinese').innerHTML = chineseWithBlank;
  $('chinese').className = 'chinese'; // Reset transform classes
  $('chinese').style.cssText = ''; // Reset inline styles
  
  // Render answer buttons
  const answersDiv = $('answers');
  answersDiv.innerHTML = allAnswers.map((ans, i) => `
    <button type="button" class="answer-btn" data-index="${i}">
      <kbd>${i + 1}</kbd>&nbsp; ${ans}
    </button>
  `).join('');
  
  // Remove any existing hint
  const existingHint = document.getElementById('sentence-hint');
  if (existingHint) existingHint.remove();
  
  // Add click listeners to answer buttons
  answersDiv.querySelectorAll('.answer-btn').forEach((btn, i) => {
    btn.onclick = () => selectSentenceAnswer(btn, allAnswers[i]);
  });
  
  // Update progress
  const pct = ((currentWordIndex + 1) / session.sentences.length) * 100;
  $('progress').style.width = `${pct}%`;
  $('current-count').textContent = `${currentWordIndex + 1} / ${session.sentences.length}`;
  $('correct-count').textContent = session.correct;
  $('wrong-count').textContent = session.wrong;
  
  $('feedback').textContent = '';
  $('feedback').className = 'feedback';
  $('next-btn').classList.remove('show');
  
  // Auto-play audio for the full sentence
  const fullSentence = sentence.c.replace('___', sentence.answerC);
  setTimeout(() => speak(fullSentence), 300);
}

function selectSentenceAnswer(btn, answer) {
  if (answered) return;
  answered = true;
  
  const sentence = session.sentences[currentWordIndex];
  const correct = answer === sentence.answer;
  const quizCard = document.querySelector('.quiz-card');
  
  // Mark card as answered to stop blank pulse animation
  quizCard.classList.add('answered');
  
  // Get the blank boxes
  const pinyinBlank = document.getElementById('pinyin-blank');
  const chineseBlank = document.getElementById('chinese-blank');
  const chineseEl = $('chinese');
  
  // Fill in the pinyin blank immediately
  if (pinyinBlank) {
    pinyinBlank.classList.add('filled');
    pinyinBlank.innerHTML = `<span class="blank-answer">${sentence.answer}</span>`;
  }
  
  // Fill in the Chinese blank
  if (chineseBlank) {
    chineseBlank.classList.add('filled');
    chineseBlank.innerHTML = `<span class="blank-answer">${sentence.answerC}</span>`;
  }
  
  if (correct) {
    session.correct++;
    progress.stats.totalCorrect++;
    btn.classList.add('correct');
    $('feedback').textContent = 'âœ“ Correct!';
    $('feedback').className = 'feedback correct';
    
    // Mark as mastered if not in review
    if (session.type !== 'sentence-review') {
      progress.masteredSentences[getSentenceId(sentence)] = true;
    } else {
      updateReviewSentence(sentence, true);
    }
  } else {
    session.wrong++;
    progress.stats.totalWrong++;
    session.wrongSentences.push(sentence);
    btn.classList.add('wrong');
    $('feedback').textContent = `âœ— The answer was: ${sentence.answer}`;
    $('feedback').className = 'feedback wrong';
    
    // Show correct answer button
    document.querySelectorAll('.answer-btn').forEach(b => {
      const btnText = b.textContent.replace(/^\d\s*/, '').trim();
      if (btnText === sentence.answer) {
        b.classList.add('reveal');
      }
    });
    
    // Add to review if not already reviewing
    if (session.type !== 'sentence-review') {
      addSentenceToReview(sentence, sentence.level);
    } else {
      updateReviewSentence(sentence, false);
    }
  }
  
  saveProgress();
  
  // Disable all buttons
  document.querySelectorAll('.answer-btn').forEach(b => b.disabled = true);
  
  $('correct-count').textContent = session.correct;
  $('wrong-count').textContent = session.wrong;
  
  // After a short delay, transform Chinese into English
  setTimeout(() => {
    chineseEl.classList.add('chinese-transform');
    setTimeout(() => {
      chineseEl.innerHTML = `<span class="english-reveal">${sentence.e}</span>`;
    }, 300); // Halfway through the transform animation
  }, 500); // Wait for blank fill animation
  
  // Always show Next button for sentences (no auto-advance)
  $('next-btn').classList.add('show');
  $('next-btn').onclick = nextSentenceQuestion;
}

function nextSentenceQuestion() {
  currentWordIndex++;
  if (currentWordIndex >= session.sentences.length) {
    showSentenceComplete();
  } else {
    renderSentenceQuestion();
  }
}

function showSentenceComplete() {
  $('quiz-area').style.display = 'none';
  $('complete-screen').classList.add('show');
  
  // Remove sentence hint if present
  const hintEl = document.getElementById('sentence-hint');
  if (hintEl) hintEl.remove();
  
  const total = session.correct + session.wrong;
  const pct = total > 0 ? Math.round((session.correct / total) * 100) : 0;
  
  $('final-correct').textContent = session.correct;
  $('final-correct').className = 'value good';
  $('final-wrong').textContent = session.wrong;
  $('final-wrong').className = session.wrong > 0 ? 'value bad' : 'value';
  $('final-accuracy').textContent = `${pct}%`;
  
  // Show review notice if there were wrong answers
  const notice = document.querySelector('.review-notice');
  if (session.wrongSentences.length > 0) {
    notice.textContent = `${session.wrongSentences.length} sentence${session.wrongSentences.length > 1 ? 's' : ''} added to review`;
    notice.style.display = 'block';
  } else {
    notice.style.display = 'none';
  }
  
  // Hide study review button for sentences (or could add sentence-specific one)
  $('study-review-btn').style.display = 'none';
}

function showQuizSession() {
  $('main-menu').classList.add('hidden');
  $('quiz-session').classList.add('active');
  $('quiz-area').style.display = 'flex';
  $('complete-screen').classList.remove('show');
  
  $('session-title').textContent = session.type === 'review' ? 'Review' : `Level ${session.level}`;
  $('session-subtitle').textContent = session.category;
  
  renderQuestion();
}

function renderQuestion() {
  answered = false;
  const word = session.words[currentWordIndex];
  const quizCard = document.querySelector('.quiz-card');
  
  // Remove sentence-mode class for vocab
  quizCard.classList.remove('sentence-mode', 'answered');
  
  // Get wrong answers from same category
  let pool;
  if (session.type === 'review') {
    // For review, use words from same original category if possible
    pool = getAllWordsInCategory(word.level, word.category);
    if (pool.length < 3) {
      pool = getAllWordsInLevel(word.level);
    }
  } else if (session.type === 'category') {
    pool = getAllWordsInCategory(session.level, session.category);
  } else {
    pool = getAllWordsInLevel(session.level);
  }
  
  const wrongAnswers = getWrongAnswers(word, pool, 2);
  const allAnswers = shuffle([word.e, ...wrongAnswers]);
  
  // Update display
  $('card-label').textContent = word.category || session.category;
  $('pinyin').textContent = word.p;
  $('pinyin').style.cssText = ''; // Reset inline styles
  $('chinese').textContent = word.c;
  $('chinese').className = 'chinese'; // Reset classes
  $('chinese').style.cssText = ''; // Reset inline styles
  
  // Adjust font size for long pinyin
  const isLong = word.p.length > 12;
  $('pinyin').style.fontSize = isLong ? '2rem' : '';
  
  // Render answer buttons
  const answersDiv = $('answers');
  answersDiv.innerHTML = allAnswers.map((ans, i) => `
    <button type="button" class="answer-btn" data-index="${i}">
      <kbd>${i + 1}</kbd>&nbsp; ${ans}
    </button>
  `).join('');
  
  // Add click listeners to answer buttons
  answersDiv.querySelectorAll('.answer-btn').forEach((btn, i) => {
    btn.onclick = () => selectAnswer(btn, allAnswers[i]);
  });
  
  // Update progress
  const pct = ((currentWordIndex + 1) / session.words.length) * 100;
  $('progress').style.width = `${pct}%`;
  $('current-count').textContent = `${currentWordIndex + 1} / ${session.words.length}`;
  $('correct-count').textContent = session.correct;
  $('wrong-count').textContent = session.wrong;
  
  $('feedback').textContent = '';
  $('feedback').className = 'feedback';
  $('next-btn').classList.remove('show');
  
  // Auto-play audio
  setTimeout(() => speak(word.c), 300);
}

function selectAnswer(btn, answer) {
  if (answered) return;
  answered = true;
  
  const word = session.words[currentWordIndex];
  const correct = answer === word.e;
  
  // Update stats
  if (correct) {
    session.correct++;
    progress.stats.totalCorrect++;
    btn.classList.add('correct');
    $('feedback').textContent = 'âœ“ Correct!';
    $('feedback').className = 'feedback correct';
    
    // Mark as mastered if not in review
    if (session.type !== 'review') {
      progress.mastered[getWordId(word)] = true;
    } else {
      updateReviewWord(word, true);
    }
  } else {
    session.wrong++;
    progress.stats.totalWrong++;
    session.wrongWords.push(word);
    btn.classList.add('wrong');
    $('feedback').textContent = `âœ— Correct answer: ${word.e}`;
    $('feedback').className = 'feedback wrong';
    
    // Show correct answer - find button by text content
    document.querySelectorAll('.answer-btn').forEach(b => {
      // Get the text after the kbd element
      const btnText = b.textContent.replace(/^\d\s*/, '').trim();
      if (btnText === word.e) {
        b.classList.add('reveal');
      }
    });
    
    // Add to review if not already reviewing
    if (session.type !== 'review') {
      addToReview(word, word.level || session.level, word.category || session.category);
    } else {
      updateReviewWord(word, false);
    }
  }
  
  // Update category stats
  const catKey = `${word.level || session.level}_${word.category || session.category}`;
  if (!progress.categoryStats[catKey]) {
    progress.categoryStats[catKey] = { correct: 0, wrong: 0 };
  }
  if (correct) {
    progress.categoryStats[catKey].correct++;
  } else {
    progress.categoryStats[catKey].wrong++;
  }
  
  saveProgress();
  
  // Disable all buttons
  document.querySelectorAll('.answer-btn').forEach(b => b.disabled = true);
  
  $('correct-count').textContent = session.correct;
  $('wrong-count').textContent = session.wrong;
  
  // Auto-advance on correct, show next button on wrong
  if (correct) {
    setTimeout(nextQuestion, 400);
  } else {
    $('next-btn').classList.add('show');
  }
}

function nextQuestion() {
  currentWordIndex++;
  if (currentWordIndex >= session.words.length) {
    showComplete();
  } else {
    renderQuestion();
  }
}

function showComplete() {
  $('quiz-area').style.display = 'none';
  $('complete-screen').classList.add('show');
  
  const total = session.correct + session.wrong;
  const accuracy = total > 0 ? Math.round((session.correct / total) * 100) : 0;
  
  $('final-correct').textContent = session.correct;
  $('final-wrong').textContent = session.wrong;
  $('final-accuracy').textContent = `${accuracy}%`;
  
  if (session.wrongWords.length > 0 && session.type !== 'review') {
    $('review-notice').textContent = `${session.wrongWords.length} word${session.wrongWords.length !== 1 ? 's' : ''} added to Review`;
    $('study-review-btn').style.display = 'inline-block';
  } else if (session.type === 'review') {
    const remaining = progress.reviewWords.length;
    $('review-notice').textContent = remaining > 0 
      ? `${remaining} word${remaining !== 1 ? 's' : ''} remaining in Review` 
      : 'Review complete!';
    $('study-review-btn').style.display = remaining > 0 ? 'inline-block' : 'none';
  } else {
    $('review-notice').textContent = 'Perfect score!';
    $('study-review-btn').style.display = 'none';
  }
}

function restartSession() {
  // Handle sentence sessions
  if (session.sentences) {
    session.sentences = shuffle(session.sentences);
    session.correct = 0;
    session.wrong = 0;
    session.wrongSentences = [];
    currentWordIndex = 0;
    
    $('quiz-area').style.display = 'flex';
    $('complete-screen').classList.remove('show');
    renderSentenceQuestion();
    return;
  }
  
  // Handle word sessions
  session.words = shuffle(session.words);
  session.correct = 0;
  session.wrong = 0;
  session.wrongWords = [];
  currentWordIndex = 0;
  
  $('quiz-area').style.display = 'flex';
  $('complete-screen').classList.remove('show');
  renderQuestion();
}

function showMenu() {
  $('main-menu').classList.remove('hidden');
  $('quiz-session').classList.remove('active');
  // Clean up sentence hint if present
  const hintEl = document.getElementById('sentence-hint');
  if (hintEl) hintEl.remove();
  renderMenu();
}

// ============ EVENT LISTENERS ============
$('back-btn').onclick = showMenu;
$('menu-btn').onclick = showMenu;
$('restart-btn').onclick = restartSession;
$('next-btn').onclick = nextQuestion;
$('audio-btn').onclick = () => {
  if (session) {
    if (session.sentences && session.sentences[currentWordIndex]) {
      const s = session.sentences[currentWordIndex];
      speak(s.c.replace('___', s.answerC));
    } else if (session.words && session.words[currentWordIndex]) {
      speak(session.words[currentWordIndex].c);
    }
  }
};
$('study-review-btn').onclick = () => {
  startReview();
};

// Settings modal
$('settings-btn').onclick = openSettings;
$('modal-close').onclick = closeSettings;
$('reset-all-btn').onclick = resetAll;
$('settings-modal').onclick = (e) => {
  if (e.target === $('settings-modal')) closeSettings();
};
document.querySelectorAll('.reset-btn[data-level]').forEach(btn => {
  btn.onclick = () => resetLevel(parseInt(btn.dataset.level));
});

// Keyboard shortcuts
document.onkeydown = e => {
  if (!$('quiz-session').classList.contains('active')) return;
  
  if ($('complete-screen').classList.contains('show')) {
    if (e.key === 'Enter') restartSession();
    if (e.key === 'Escape') showMenu();
    return;
  }
  
  if (e.key === ' ') {
    e.preventDefault();
    if (session) {
      if (session.sentences && session.sentences[currentWordIndex]) {
        const s = session.sentences[currentWordIndex];
        speak(s.c.replace('___', s.answerC));
      } else if (session.words && session.words[currentWordIndex]) {
        speak(session.words[currentWordIndex].c);
      }
    }
  } else if (e.key === 'Enter' && answered) {
    if (session.sentences) {
      nextSentenceQuestion();
    } else {
      nextQuestion();
    }
  } else if (!answered && ['1', '2', '3', '4'].includes(e.key)) {
    const btns = document.querySelectorAll('.answer-btn');
    const idx = parseInt(e.key) - 1;
    if (btns[idx]) {
      btns[idx].click();
    }
  } else if (e.key === 'Escape') {
    showMenu();
  }
};

// ============ INIT ============
try {
  renderMenu();
  // Hide splash screen after a brief moment
  setTimeout(() => {
    const splash = document.getElementById('splash');
    if (splash) splash.classList.add('hidden');
  }, 800);
  console.log('Chinese Quiz initialized successfully');
} catch(e) {
  console.error('Error initializing:', e);
  document.body.innerHTML = '<div style="color:white;padding:2rem;"><h1>Error loading quiz</h1><pre>' + e.message + '\n' + e.stack + '</pre></div>';
}
</script>
</body>
</html>
